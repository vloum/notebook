# NoteBrain - äº§å“å®ç°è®¡åˆ’

> AI é©±åŠ¨çš„ä¸ªäººçŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œé€šè¿‡ MCP åè®®è®© Agent å¸®ä½ ç®¡ç†ã€æ£€ç´¢ã€æ›´æ–°ç¬”è®°æ–‡æ¡£ã€‚

---

## ä¸€ã€æ ¸å¿ƒéœ€æ±‚

1. **é€šè¿‡ MCP æ›´æ–°æ–‡æ¡£**ï¼šAgent èƒ½å®šä½åˆ°ä¸€ç¯‡å…·ä½“æ–‡æ¡£ï¼Œè¯»æ‡‚å†…å®¹ï¼Œåšå±€éƒ¨æˆ–æ•´ä½“ä¿®æ”¹ï¼Œå†™å›ä¿å­˜ã€‚
2. **ä¸€å¥è¯æ‰¾åˆ°èµ„æ–™**ï¼šAgent èƒ½åœ¨å¤§é‡æ–‡æ¡£ä¸­å¿«é€Ÿç¼©å°èŒƒå›´ï¼Œè¿”å›æœ€ç›¸å…³çš„å‡ ç¯‡ï¼Œå¹¶èƒ½ç»™å‡ºå‘½ä¸­ä¾æ®ã€‚

---

## äºŒã€æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| å‰ç«¯ | Next.js 15 (App Router) + React 19 + TypeScript | å…¨æ ˆæ¡†æ¶ï¼ŒSSR/SSG æ”¯æŒ |
| æ ·å¼ | Tailwind CSS 4 + shadcn/ui | ç°ä»£ UI ç»„ä»¶åº“ï¼Œå¯å®šåˆ¶æ€§å¼º |
| åç«¯ API | Next.js Route Handlers (`app/api/`) | å…¨æ ˆä¸€ä½“ï¼Œæ— éœ€ç‹¬ç«‹åç«¯ |
| æ•°æ®åº“ | PostgreSQL + pgvector æ‰©å±• | ä¸šåŠ¡æ•°æ® + å‘é‡ + å…¨æ–‡æ£€ç´¢ä¸€ä½“ |
| ORM | Prisma | ç±»å‹å®‰å…¨çš„æ•°æ®åº“è®¿é—® |
| è®¤è¯ | NextAuth.js (Auth.js v5) | æ”¯æŒå¤šç§ç™»å½•æ–¹å¼ |
| Markdown ç¼–è¾‘å™¨ | Milkdown æˆ– CodeMirror | æ‰€è§å³æ‰€å¾— / çº¯æ–‡æœ¬ç¼–è¾‘ |
| Markdown æ¸²æŸ“ | react-markdown + remark/rehype æ’ä»¶ | æ”¯æŒä»£ç é«˜äº®ã€è¡¨æ ¼ã€GFM |
| MCP Server | ç‹¬ç«‹ Node.js + TypeScript è¿›ç¨‹ | é€šè¿‡ HTTP è°ƒç”¨ Next.js API |
| Embedding æ¨¡å‹ | OpenAI text-embedding-3-smallï¼ˆæˆ–æœ¬åœ° bge-m3ï¼‰ | ä¸­æ–‡è¯­ä¹‰æ£€ç´¢ |
| ä¸­æ–‡åˆ†è¯ | pg_jieba æˆ– zhparser | PG å…¨æ–‡æ£€ç´¢ä¸­æ–‡æ”¯æŒ |
| å¼‚æ­¥ä»»åŠ¡ | pg-bossï¼ˆåŸºäº PG çš„ä»»åŠ¡é˜Ÿåˆ—ï¼‰ | embedding æ›´æ–°ã€æ—¥å¿—æ¸…ç†ç­‰ |

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 å®Œæ•´ ER å…³ç³»

```
users ||--o{ notebooks : owns
users ||--o{ entries : owns
notebooks ||--o{ entries : contains
entries ||--o{ entry_tags : has
tags ||--o{ entry_tags : used_in
entries ||--o{ entry_relations : from
entries ||--o{ entry_relations : to
entries ||--o{ entry_chunks : split_into
entries ||--o{ entry_versions : versioned
users ||--o{ agent_logs : has
users ||--o{ api_keys : owns
```

### 3.2 è¡¨ç»“æ„

#### usersï¼ˆç”¨æˆ·è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| email | VARCHAR UNIQUE | é‚®ç®± |
| name | VARCHAR | æ˜¾ç¤ºåç§° |
| avatar_url | VARCHAR | å¤´åƒåœ°å€ |
| password_hash | VARCHAR | å¯†ç å“ˆå¸Œ |
| settings | JSONB | ç”¨æˆ·è®¾ç½®ï¼ˆä¸»é¢˜ã€è¯­è¨€ç­‰ï¼‰ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

#### notebooksï¼ˆç¬”è®°æœ¬è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| name | VARCHAR | ç¬”è®°æœ¬åç§° |
| description | TEXT | æè¿° |
| icon | VARCHAR | å›¾æ ‡ï¼ˆemoji æˆ–å›¾æ ‡åï¼‰ |
| sort_order | INTEGER | æ’åºæƒé‡ |
| is_default | BOOLEAN | æ˜¯å¦ä¸ºé»˜è®¤ç¬”è®°æœ¬ |
| is_archived | BOOLEAN | æ˜¯å¦å½’æ¡£ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

#### entriesï¼ˆæ–‡æ¡£/æ¡ç›®è¡¨ - æ ¸å¿ƒè¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| notebook_id | UUID FK â†’ notebooks | æ‰€å±ç¬”è®°æœ¬ |
| title | VARCHAR | æ–‡æ¡£æ ‡é¢˜ |
| content | TEXT | Markdown æ­£æ–‡ |
| summary | TEXT | æ‘˜è¦ï¼ˆè‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨ï¼‰ |
| type | ENUM('note','diary','experience','document') | æ–‡æ¡£ç±»å‹ |
| source | ENUM('manual','agent','import') | æ¥æº |
| word_count | INTEGER | å­—æ•° |
| version | INTEGER DEFAULT 1 | ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰ |
| summary_embedding | vector(1536) | æ ‡é¢˜+æ‘˜è¦çš„ embedding |
| search_vector | tsvector | å…¨æ–‡æ£€ç´¢åˆ†è¯å‘é‡ |
| metadata | JSONB | æ‰©å±•å…ƒæ•°æ® |
| is_pinned | BOOLEAN | æ˜¯å¦ç½®é¡¶ |
| is_archived | BOOLEAN | æ˜¯å¦å½’æ¡£ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

ç´¢å¼•ï¼š
- `USING hnsw (summary_embedding vector_cosine_ops)` â€” å‘é‡è¿‘ä¼¼æœç´¢
- `USING gin (search_vector)` â€” å…¨æ–‡æ£€ç´¢
- `USING gin (metadata)` â€” JSONB æŸ¥è¯¢
- `(user_id, notebook_id, updated_at DESC)` â€” åˆ—è¡¨æŸ¥è¯¢
- `(user_id, type, updated_at DESC)` â€” æŒ‰ç±»å‹ç­›é€‰

#### tagsï¼ˆæ ‡ç­¾è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| name | VARCHAR | æ ‡ç­¾å |
| color | VARCHAR | æ ‡ç­¾é¢œè‰²ï¼ˆå¯é€‰ï¼‰ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

å”¯ä¸€çº¦æŸï¼š`(user_id, name)`

#### entry_tagsï¼ˆæ–‡æ¡£-æ ‡ç­¾å…³è”è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| entry_id | UUID FK â†’ entries | æ–‡æ¡£ ID |
| tag_id | UUID FK â†’ tags | æ ‡ç­¾ ID |

å¤åˆä¸»é”®ï¼š`(entry_id, tag_id)`

#### entry_relationsï¼ˆæ–‡æ¡£å…³è”è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| from_id | UUID FK â†’ entries | æ¥æºæ–‡æ¡£ |
| to_id | UUID FK â†’ entries | ç›®æ ‡æ–‡æ¡£ |
| type | ENUM('references','continues','related','contradicts','summarizes') | å…³è”ç±»å‹ |
| metadata | JSONB | å…³è”çš„é¢å¤–ä¿¡æ¯ï¼ˆå¦‚å…³è”åŸå› ï¼‰ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

å”¯ä¸€çº¦æŸï¼š`(from_id, to_id, type)`

å…³è”ç±»å‹è¯´æ˜ï¼š
- `references` â€” A å¼•ç”¨ B
- `continues` â€” B æ˜¯ A çš„ç»­å†™
- `related` â€” ç›¸å…³ä¸»é¢˜
- `contradicts` â€” A ä¿®æ­£/æ¨ç¿»äº† B çš„ç»“è®º
- `summarizes` â€” A æ˜¯ B çš„æ€»ç»“

#### entry_chunksï¼ˆæ–‡æ¡£åˆ†æ®µè¡¨ - ç”¨äºé•¿æ–‡æ¡£å‘é‡æ£€ç´¢ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| entry_id | UUID FK â†’ entries (CASCADE) | æ‰€å±æ–‡æ¡£ |
| chunk_index | INTEGER | æ®µè½åºå· |
| heading | TEXT | section æ ‡é¢˜ï¼ˆå¦‚ "## è¸©å‘è®°å½•"ï¼‰ |
| content | TEXT | section æ­£æ–‡ |
| embedding | vector(1536) | è¯¥æ®µè½çš„å‘é‡ |
| token_count | INTEGER | token æ•°é‡ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

ç´¢å¼•ï¼š
- `USING hnsw (embedding vector_cosine_ops)` â€” æ®µè½çº§å‘é‡æœç´¢
- `(entry_id, chunk_index)` â€” æŒ‰æ–‡æ¡£å’Œé¡ºåºæŸ¥è¯¢

#### entry_versionsï¼ˆç‰ˆæœ¬å†å²è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| entry_id | UUID FK â†’ entries (CASCADE) | æ‰€å±æ–‡æ¡£ |
| version | INTEGER | ç‰ˆæœ¬å· |
| title | VARCHAR | è¯¥ç‰ˆæœ¬çš„æ ‡é¢˜ |
| content | TEXT | è¯¥ç‰ˆæœ¬çš„å®Œæ•´ Markdown å†…å®¹ |
| summary | TEXT | è¯¥ç‰ˆæœ¬çš„æ‘˜è¦ |
| change_summary | VARCHAR | å˜æ›´è¯´æ˜ï¼ˆå¦‚ "è¿½åŠ è¸©å‘è®°å½•"ï¼‰ |
| source | ENUM('manual','agent') | ä¿®æ”¹æ¥æº |
| word_count | INTEGER | å­—æ•° |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

ç´¢å¼•ï¼š`(entry_id, version DESC)`

#### agent_logsï¼ˆAgent æ“ä½œæ—¥å¿—è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| action | VARCHAR(50) | æ“ä½œç±»å‹ï¼šcreate / update / delete / add_tag / add_relation / remove_tag / move |
| entry_id | UUID | æ“ä½œçš„æ–‡æ¡£ï¼ˆå¯ä¸ºç©ºï¼Œå¦‚åˆ›å»ºç¬”è®°æœ¬æ—¶ï¼‰ |
| entry_title | VARCHAR | æ–‡æ¡£æ ‡é¢˜ï¼ˆå†—ä½™å­˜å‚¨ï¼Œæ–¹ä¾¿æ—¥å¿—å±•ç¤ºï¼‰ |
| summary | TEXT | æ“ä½œæ‘˜è¦ï¼Œå¦‚ "è¿½åŠ äº†è¸©å‘è®°å½• section" |
| diff_stats | JSONB | å˜æ›´ç»Ÿè®¡ `{ added_words: 156, removed_words: 0 }` |
| metadata | JSONB | é¢å¤–ä¿¡æ¯ |
| created_at | TIMESTAMPTZ DEFAULT NOW() | æ“ä½œæ—¶é—´ |

ç´¢å¼•ï¼š`(user_id, created_at DESC)`

è‡ªåŠ¨æ¸…ç†ç­–ç•¥ï¼šä¿ç•™æœ€è¿‘ 30 å¤©çš„æ—¥å¿—
- ä½¿ç”¨ pg_cron æˆ–åº”ç”¨å±‚å®šæ—¶ä»»åŠ¡
- `DELETE FROM agent_logs WHERE created_at < NOW() - INTERVAL '30 days'`

#### api_keysï¼ˆMCP API å¯†é’¥è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| name | VARCHAR | å¯†é’¥åç§°ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼Œå¦‚ "Cursor MCP"ã€"Claude Desktop"ï¼‰ |
| key_prefix | VARCHAR(8) | å¯†é’¥å‰ç¼€ï¼ˆå¦‚ "nb_sk_3a"ï¼‰ï¼Œç”¨äºåˆ—è¡¨å±•ç¤ºæ—¶è¯†åˆ« |
| key_hash | VARCHAR UNIQUE | å¯†é’¥çš„ SHA-256 å“ˆå¸Œï¼ˆå­˜å‚¨å“ˆå¸Œè€Œéæ˜æ–‡ï¼Œå®‰å…¨ï¼‰ |
| last_used_at | TIMESTAMPTZ | æœ€åä¸€æ¬¡ä½¿ç”¨æ—¶é—´ |
| expires_at | TIMESTAMPTZ | è¿‡æœŸæ—¶é—´ï¼ˆå¯é€‰ï¼Œnull è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼‰ |
| is_active | BOOLEAN DEFAULT true | æ˜¯å¦å¯ç”¨ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

ç´¢å¼•ï¼š
- `UNIQUE (key_hash)` â€” æŸ¥æ‰¾å¯†é’¥æ—¶ç”¨å“ˆå¸ŒåŒ¹é…
- `(user_id, is_active)` â€” åˆ—å‡ºç”¨æˆ·çš„æ´»è·ƒå¯†é’¥

å¯†é’¥æ ¼å¼ï¼š`nb_sk_{32ä½éšæœºå­—ç¬¦}`ï¼ˆå¦‚ `nb_sk_3aF8kL9mN2pQ4rS6tU8vW0xY1zA3bC5d`ï¼‰

å®‰å…¨è®¾è®¡ï¼š
- **ç”Ÿæˆæ—¶åªå±•ç¤ºä¸€æ¬¡å®Œæ•´å¯†é’¥**ï¼Œä¹‹ååªæ˜¾ç¤ºå‰ç¼€ `nb_sk_3a...`
- æ•°æ®åº“åªå­˜ SHA-256 å“ˆå¸Œï¼Œä¸å­˜æ˜æ–‡
- MCP Server è¯·æ±‚æ—¶å¸¦ä¸Šå¯†é’¥ï¼Œåç«¯å“ˆå¸Œåä¸æ•°æ®åº“æ¯”å¯¹
- æ”¯æŒå¤šä¸ªå¯†é’¥ï¼ˆä¸åŒè®¾å¤‡/Agent å¯ä»¥ç”¨ä¸åŒå¯†é’¥ï¼‰
- æ”¯æŒå•ä¸ªå¯†é’¥ç¦ç”¨/åˆ é™¤ï¼Œä¸å½±å“å…¶ä»–å¯†é’¥
- æ¯æ¬¡ API è°ƒç”¨æ›´æ–° `last_used_at`ï¼Œæ–¹ä¾¿ç”¨æˆ·è¯†åˆ«å“ªäº›å¯†é’¥åœ¨ç”¨

### 3.3 MCP é‰´æƒæµç¨‹

```
MCP Client é…ç½®å¯†é’¥
    â”‚
    â”‚ è¯·æ±‚å¤´ï¼šAuthorization: Bearer nb_sk_3aF8kL...
    â–¼
MCP Server è½¬å‘è¯·æ±‚åˆ° Next.js API
    â”‚
    â”‚ è¯·æ±‚å¤´ï¼šAuthorization: Bearer nb_sk_3aF8kL...
    â–¼
Next.js API ä¸­é—´ä»¶
    â”‚
    â”œâ”€ å¦‚æœæ˜¯æµè§ˆå™¨è¯·æ±‚ â†’ èµ° NextAuth session è®¤è¯
    â”‚
    â””â”€ å¦‚æœå¸¦ Bearer tokenï¼ˆnb_sk_ å‰ç¼€ï¼‰â†’ èµ° API Key è®¤è¯
       â”‚
       â”œâ”€ SHA-256(token) â†’ æŸ¥ api_keys è¡¨
       â”œâ”€ æ ¡éªŒ is_active = true ä¸”æœªè¿‡æœŸ
       â”œâ”€ è·å– user_id â†’ æ³¨å…¥è¯·æ±‚ä¸Šä¸‹æ–‡
       â””â”€ æ›´æ–° last_used_at
```

è¿™æ · MCP Server ä¸éœ€è¦è‡ªå·±åšç”¨æˆ·ç®¡ç†ï¼Œåªéœ€è¦åœ¨é…ç½®ä¸­å¡«å…¥ç”¨æˆ·ç”Ÿæˆçš„ API Keyï¼Œæ‰€æœ‰è¯·æ±‚éƒ½æºå¸¦è¿™ä¸ª Keyï¼Œåç«¯ç»Ÿä¸€é‰´æƒã€‚

---

## å››ã€æ··åˆæ£€ç´¢æ–¹æ¡ˆ

### 4.1 æ–‡æ¡£å‘é‡åŒ–æµç¨‹

æ–‡æ¡£å†™å…¥/æ›´æ–°æ—¶ï¼š
1. **ç”Ÿæˆæ‘˜è¦ embedding**ï¼ˆæ ‡é¢˜ + æ‘˜è¦ æ‹¼æ¥åç”Ÿæˆï¼‰â†’ å­˜å…¥ `entries.summary_embedding`ï¼Œç”¨äºæ–‡æ¡£çº§ç²—æ£€ç´¢
2. **æŒ‰ heading åˆ‡åˆ† sections** â†’ æ¯ä¸ª section ç”Ÿæˆ chunk embedding â†’ å­˜å…¥ `entry_chunks`ï¼Œç”¨äºæ®µè½çº§ç²¾æ£€ç´¢
3. **ç”Ÿæˆ tsvector**ï¼ˆä¸­æ–‡åˆ†è¯åå­˜å…¥ `entries.search_vector`ï¼‰â†’ ç”¨äºå…³é”®è¯ç²¾ç¡®åŒ¹é…
4. ä»¥ä¸Šæ­¥éª¤é€šè¿‡ **å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆpg-bossï¼‰** å¤„ç†ï¼Œä¸é˜»å¡å†™å…¥è¯·æ±‚

### 4.2 æœç´¢æµç¨‹

```
ç”¨æˆ· query â†’ ç”Ÿæˆ query embedding

ç¬¬ä¸€æ­¥ï¼šå…ƒæ•°æ®è¿‡æ»¤ï¼ˆnotebook_id, tags, date_range, typeï¼‰â†’ ç¼©å°å€™é€‰é›†
ç¬¬äºŒæ­¥ï¼šåŒè·¯å¬å›
  - BM25 è·¯ï¼štsvector @@ tsqueryï¼ŒæŒ‰ç›¸å…³åº¦æ‰“åˆ†
  - å‘é‡è·¯ï¼šembedding <=> query_embeddingï¼ŒæŒ‰ä½™å¼¦ç›¸ä¼¼åº¦æ‰“åˆ†
ç¬¬ä¸‰æ­¥ï¼šRRFï¼ˆReciprocal Rank Fusionï¼‰èåˆæ’åº
  - score = 1/(k + rank_bm25) + 1/(k + rank_vector)ï¼Œk é€šå¸¸å– 60
ç¬¬å››æ­¥ï¼šè¿”å› top-k æ–‡æ¡£ï¼Œé™„å¸¦å‘½ä¸­çš„ section ç‰‡æ®µï¼ˆé«˜äº®ï¼‰
```

### 4.3 Embedding æ›´æ–°ç­–ç•¥

- æ–‡æ¡£æ›´æ–°æ—¶åœ¨ entries è¡¨æ ‡è®° `embedding_stale = true`ï¼ˆæš‚ä¸åŠ æ­¤å­—æ®µï¼Œé€šè¿‡ä»»åŠ¡é˜Ÿåˆ—çŠ¶æ€ç®¡ç†ï¼‰
- å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—æ¶ˆè´¹æ›´æ–°äº‹ä»¶ï¼Œé‡æ–°è®¡ç®— embedding
- æ‰¹é‡å¯¼å…¥åœºæ™¯ï¼šé˜Ÿåˆ—é™æµï¼Œé¿å… API è°ƒç”¨è¿‡å¿«
- embedding æ¨¡å‹å­—æ®µé¢„ç•™ï¼š`entry_chunks` å¯åŠ  `model` å­—æ®µï¼Œæ–¹ä¾¿åç»­æ¢æ¨¡å‹

---

## äº”ã€é•¿æ–‡æ¡£å¤„ç†ç­–ç•¥

### 5.1 æ ¸å¿ƒé—®é¢˜

æ–‡æ¡£å¯èƒ½å¾ˆé•¿ï¼ˆå‡ åƒç”šè‡³ä¸Šä¸‡å­—ï¼‰ï¼ŒAgent çš„ä¸Šä¸‹æ–‡çª—å£æœ‰é™ã€token è®¡è´¹æ˜‚è´µã€‚å¦‚æœæ¯æ¬¡éƒ½è¿”å›æ•´ç¯‡å†…å®¹ï¼š
- æµªè´¹ tokenï¼ˆAgent å¯èƒ½åªéœ€è¦çœ‹æŸä¸€æ®µï¼‰
- è¶…é•¿æ–‡æ¡£å¯èƒ½æ’‘çˆ†å•æ¬¡å“åº”
- Agent ä¿®æ”¹æ—¶å®¹æ˜“è¯¯æ”¹æ— å…³éƒ¨åˆ†

**çœŸå®ç±»æ¯”**ï¼šå°±åƒ Cursor ä¸­ Claude è¯»å–æœ¬é¡¹ç›®çš„ `plan.md` ä¸€æ ·â€”â€”å®ƒä¸ä¼šä¸€æ¬¡è¯»å®Œæ•´ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯ï¼š
1. å…ˆç”¨ `Read(path, offset=1, limit=50)` è¯»å‰ 50 è¡Œï¼Œäº†è§£æ–‡æ¡£ç»“æ„
2. ç”¨ `Grep` æœç´¢å…³é”®è¯ï¼Œå®šä½åˆ°å…·ä½“è¡Œå·
3. å†ç”¨ `Read(path, offset=409, limit=85)` ç²¾ç¡®è¯»å–éœ€è¦çš„éƒ¨åˆ†
4. ä¿®æ”¹æ—¶ç”¨ç²¾ç¡®çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œè€Œä¸æ˜¯é‡å†™æ•´ä¸ªæ–‡ä»¶

æˆ‘ä»¬çš„ MCP Tool è¦å®ç° **å®Œå…¨ç›¸åŒçš„èƒ½åŠ›**ï¼šè®© Agent èƒ½åˆ†æ®µè¯»å–ã€ç²¾ç¡®å®šä½ã€å±€éƒ¨ä¿®æ”¹ã€‚

### 5.2 åŒå±‚è¯»å–ç­–ç•¥ï¼šç»“æ„å¯¼èˆª + è¡Œçº§åˆ†é¡µ

#### ç¬¬ä¸€å±‚ï¼šSection ç»“æ„å¯¼èˆªï¼ˆæŒ‰ Heading åˆ‡åˆ†ï¼‰

ä»¥ Markdown Heading ä¸ºè¾¹ç•Œåˆ‡åˆ† sectionsï¼š
- é¡¶çº§æ ‡é¢˜ï¼ˆ`#`ï¼‰ä½œä¸ºæ–‡æ¡£æ ‡é¢˜ï¼Œä¸å•ç‹¬æˆ section
- `##` çº§åˆ« heading ä½œä¸ºä¸»è¦ section åˆ†ç•Œ
- `###` åŠä»¥ä¸‹ heading å½’å±åˆ°æ‰€åœ¨çš„ `##` section ä¸­
- æ²¡æœ‰ä»»ä½• heading çš„å†…å®¹å½’å±åˆ° section 0ï¼ˆå¼€ç¯‡æ®µè½ï¼‰

`entry_get(mode="outline")` è¿”å›çš„å¤§çº²é‡Œï¼Œæ¯ä¸ª section åŒ…å« **èµ·æ­¢è¡Œå·**ï¼š

```json
{
  "sections": [
    { "index": 0, "heading": "èƒŒæ™¯",     "line_start": 3,   "line_end": 15,  "word_count": 120 },
    { "index": 1, "heading": "æ–¹æ¡ˆé€‰å‹",  "line_start": 16,  "line_end": 58,  "word_count": 800 },
    { "index": 2, "heading": "è¸©å‘è®°å½•",  "line_start": 59,  "line_end": 92,  "word_count": 500 },
    { "index": 3, "heading": "ç»“è®º",     "line_start": 93,  "line_end": 105, "word_count": 200 }
  ],
  "total_lines": 105
}
```

Agent çœ‹åˆ°å¤§çº²åå°±çŸ¥é“ï¼š"è¸©å‘è®°å½•" åœ¨ç¬¬ 59-92 è¡Œï¼Œæˆ‘åªéœ€è¦è¯»è¿™éƒ¨åˆ†ã€‚

#### ç¬¬äºŒå±‚ï¼šè¡Œçº§åˆ†é¡µè¯»å–ï¼ˆoffset + limitï¼‰

`entry_get` æ”¯æŒ `offset`ï¼ˆèµ·å§‹è¡Œå·ï¼‰å’Œ `limit`ï¼ˆè¯»å–è¡Œæ•°ï¼‰å‚æ•°ï¼Œ**å’Œ Cursor çš„ Read å·¥å…·å‚æ•°å®Œå…¨ä¸€è‡´**ï¼š

```
entry_get(id, offset=59, limit=34)
â†’ è¿”å›ç¬¬ 59 è¡Œåˆ°ç¬¬ 92 è¡Œçš„å†…å®¹ï¼ˆå³"è¸©å‘è®°å½•" sectionï¼‰
```

å¦‚æœæŸä¸ª section æœ¬èº«ä¹Ÿå¾ˆé•¿ï¼ˆæ¯”å¦‚ 200 è¡Œï¼‰ï¼ŒAgent å¯ä»¥ç»§ç»­åˆ†é¡µï¼š

```
entry_get(id, offset=59, limit=50)   â†’ è¯»ç¬¬ 59-108 è¡Œï¼ˆå‰åŠæ®µï¼‰
entry_get(id, offset=109, limit=50)  â†’ è¯»ç¬¬ 109-158 è¡Œï¼ˆååŠæ®µï¼‰
```

**è¿”å›æ ¼å¼å¸¦è¡Œå·**ï¼Œæ–¹ä¾¿ Agent å®šä½ï¼š

```json
{
  "id": "uuid",
  "title": "Redisç¼“å­˜ç­–ç•¥æ€»ç»“",
  "total_lines": 105,
  "showing": { "offset": 59, "limit": 34 },
  "content": "59| ## è¸©å‘è®°å½•\n60| \n61| ### 1. å†…å­˜æº¢å‡º\n62| é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€...\n...\n92| æœ€ç»ˆé€šè¿‡ç›‘æ§å‘Šè­¦è§£å†³ã€‚",
  "version": 5
}
```

### 5.3 ä¸‰ç§è¯»å–æ¨¡å¼æ€»ç»“

| æ¨¡å¼ | å‚æ•° | è¿”å›å†…å®¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|----------|
| **å…¨æ–‡æ¨¡å¼** | `mode="full"` æˆ–ä¸ä¼ ï¼ˆçŸ­æ–‡æ¡£è‡ªåŠ¨ï¼‰ | å®Œæ•´ Markdown + å…ƒæ•°æ® | çŸ­æ–‡æ¡£ï¼ˆ< 2000 å­—ï¼‰ï¼ŒAgent ç›´æ¥é€šè¯» |
| **å¤§çº²æ¨¡å¼** | `mode="outline"` æˆ–ä¸ä¼ ï¼ˆé•¿æ–‡æ¡£è‡ªåŠ¨ï¼‰ | æ ‡é¢˜ + section åˆ—è¡¨ï¼ˆå«è¡Œå·ï¼‰+ å…ƒæ•°æ® | é•¿æ–‡æ¡£é¦–æ¬¡æ‰“å¼€ï¼ŒAgent äº†è§£ç»“æ„ |
| **åˆ†é¡µæ¨¡å¼** | `offset` + `limit` | æŒ‡å®šè¡ŒèŒƒå›´çš„å†…å®¹ï¼ˆå¸¦è¡Œå·ï¼‰ | ç²¾ç¡®è¯»å–æŸä¸ªæ®µè½ / section å¤ªé•¿æ—¶åˆ†é¡µ |

Agent çš„å…¸å‹æ“ä½œæµç¨‹ï¼š

```
â‘  entry_get(id)
   â†’ çŸ­æ–‡æ¡£ï¼šè‡ªåŠ¨è¿”å›å…¨æ–‡ï¼Œç›´æ¥æ“ä½œ
   â†’ é•¿æ–‡æ¡£ï¼šè‡ªåŠ¨è¿”å›å¤§çº² + section è¡Œå·åˆ—è¡¨

â‘¡ å¦‚æœæ˜¯é•¿æ–‡æ¡£ï¼ŒAgent æ ¹æ®å¤§çº²åˆ¤æ–­è¦è¯»å“ªéƒ¨åˆ†
   entry_get(id, offset=59, limit=34)
   â†’ è¿”å› "è¸©å‘è®°å½•" section çš„å†…å®¹ï¼ˆå¸¦è¡Œå·ï¼‰

â‘¢ å¦‚æœè¿”å›çš„éƒ¨åˆ†è¿˜æ˜¯å¤ªé•¿ï¼Œç»§ç»­åˆ†é¡µ
   entry_get(id, offset=59, limit=50)
   entry_get(id, offset=109, limit=50)

â‘£ ä¿®æ”¹ï¼šç”¨ entry_update_section æŒ‰ section æ›´æ–°
   æˆ–ç”¨ entry_update æ•´ç¯‡æ›¿æ¢ï¼ˆçŸ­æ–‡æ¡£åœºæ™¯ï¼‰
```

### 5.4 åˆ†é¡µè¯»å–ä¸ Section è¯»å–çš„å…³ç³»

`entry_get_section(id, section_index)` å®é™…ä¸Šæ˜¯ `entry_get(id, offset, limit)` çš„ **è¯­æ³•ç³–**ï¼š

```
entry_get_section(id, section_index=2)
  â‰¡ entry_get(id, offset=sections[2].line_start, limit=sections[2].line_end - sections[2].line_start + 1)
```

ä¸¤ç§æ–¹å¼éƒ½ä¿ç•™ï¼ŒAgent å¯ä»¥é€‰æ‹©ï¼š
- çŸ¥é“ section åºå·æ—¶ â†’ ç”¨ `entry_get_section`ï¼ˆç®€æ´ï¼‰
- éœ€è¦æ›´çµæ´»çš„èŒƒå›´æ—¶ â†’ ç”¨ `entry_get(offset, limit)`ï¼ˆæ¯”å¦‚è·¨è¶Šä¸¤ä¸ª sectionï¼‰
- éœ€è¦æŒ‰è¡Œç²¾ç¡®æ§åˆ¶æ—¶ â†’ ç”¨ `entry_get(offset, limit)`ï¼ˆæ¯”å¦‚åªçœ‹æŸä¸ª section çš„å‰ 20 è¡Œï¼‰

### 5.5 å†™å…¥ä¹Ÿæ”¯æŒè¡Œçº§å®šä½

`entry_update_section` æŒ‰ section æ•´ä½“æ›¿æ¢æ²¡é—®é¢˜ï¼Œä½†æœ‰æ—¶ Agent åªæƒ³æ”¹æŸå‡ è¡Œã€‚æä¾›ä¸€ä¸ªç²¾ç¡®æ›¿æ¢å·¥å…·ï¼š

**`entry_replace`** â€” åœ¨æ–‡æ¡£ä¸­åšç²¾ç¡®å­—ç¬¦ä¸²æ›¿æ¢ï¼ˆç±»ä¼¼ Cursor çš„ StrReplaceï¼‰

```json
{
  "id": "string (å¿…å¡«)",
  "old_text": "string (å¿…å¡«ï¼Œè¦æ›¿æ¢çš„åŸæ–‡ï¼Œå¿…é¡»åœ¨æ–‡æ¡£ä¸­å”¯ä¸€åŒ¹é…)",
  "new_text": "string (å¿…å¡«ï¼Œæ›¿æ¢åçš„å†…å®¹)",
  "version": "number (å¿…å¡«ï¼Œä¹è§‚é”)"
}
```

è¿™æ · Agent ä¸éœ€è¦è¯»å–å’Œé‡å†™æ•´ä¸ª sectionï¼Œåªéœ€è¦ï¼š
1. å®šä½åˆ°è¦æ”¹çš„é‚£å‡ è¡Œï¼ˆé€šè¿‡ offset+limit çœ‹åˆ°ï¼‰
2. ç”¨ `entry_replace` ç²¾ç¡®æ›¿æ¢é‚£å‡ è¡Œ

è¿™å’Œ Cursor ä¸­ Claude ä½¿ç”¨ `StrReplace` ç¼–è¾‘æ–‡ä»¶çš„æ–¹å¼ **å®Œå…¨ä¸€è‡´**ã€‚

### 5.6 Section æ›´æ–°åçš„å¤„ç†

1. æ›¿æ¢ç›®æ ‡ section å†…å®¹ï¼ˆæˆ–æ‰§è¡Œ entry_replace çš„ç²¾ç¡®æ›¿æ¢ï¼‰
2. æ‹¼å›å®Œæ•´æ–‡æ¡£ï¼Œé‡æ–°è®¡ç®—è¡Œå·æ˜ å°„
3. æ›´æ–° `entries.content`ã€`entries.word_count`ã€`entries.search_vector`
4. `version + 1`
5. ä¿å­˜ç‰ˆæœ¬å¿«ç…§åˆ° `entry_versions`
6. å¼‚æ­¥é‡æ–°è®¡ç®—å—å½±å“ section çš„ chunk embedding
7. å¼‚æ­¥æ›´æ–°æ–‡æ¡£çš„ summary_embeddingï¼ˆå¦‚æœæ‘˜è¦å˜äº†ï¼‰
8. å†™å…¥ `agent_logs`

### 5.7 å®Œæ•´ç¤ºä¾‹ï¼šAgent ä¿®æ”¹ä¸€ç¯‡ 5000 å­—é•¿æ–‡æ¡£

```
ç”¨æˆ·ï¼š"æŠŠ Redis ç¼“å­˜é‚£ç¯‡ç¬”è®°çš„è¸©å‘è®°å½•é‡Œï¼Œå†…å­˜æº¢å‡ºé‚£æ®µåŠ ä¸Šè§£å†³æ–¹æ¡ˆ"

â”€â”€â”€ Agent å†…éƒ¨æ€è€ƒ + è°ƒç”¨ â”€â”€â”€

â‘  entries_search(query="Redis ç¼“å­˜ è¸©å‘ å†…å­˜æº¢å‡º")
   â†’ å‘½ä¸­ "Redisç¼“å­˜ç­–ç•¥æ€»ç»“"ï¼ˆid: abc, word_count: 5200ï¼‰

â‘¡ entry_get(id="abc")
   â†’ é•¿æ–‡æ¡£ï¼Œè‡ªåŠ¨è¿”å›å¤§çº²ï¼š
     section 0: "èƒŒæ™¯"       lines 3-15    (120å­—)
     section 1: "æ–¹æ¡ˆé€‰å‹"    lines 16-58   (800å­—)
     section 2: "è¸©å‘è®°å½•"    lines 59-92   (500å­—)   â† ç›®æ ‡
     section 3: "ç»“è®º"       lines 93-105  (200å­—)

â‘¢ entry_get(id="abc", offset=59, limit=34)
   â†’ è¿”å›è¸©å‘è®°å½•å®Œæ•´å†…å®¹ï¼ˆå¸¦è¡Œå·ï¼‰ï¼š
     59| ## è¸©å‘è®°å½•
     60|
     61| ### 1. å†…å­˜æº¢å‡º
     62| é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€å¯¼è‡´ OOM...
     63| ï¼ˆæ­¤å¤„ç¼ºå°‘è§£å†³æ–¹æ¡ˆï¼‰
     64|
     65| ### 2. è¿‡æœŸé”®æ¸…ç†
     ...

â‘£ Agent å‘ç°ç¬¬ 63 è¡Œä¹‹åéœ€è¦è¡¥å……è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ç²¾ç¡®æ›¿æ¢ï¼š

   entry_replace(
     id="abc",
     old_text="é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€å¯¼è‡´ OOM...\nï¼ˆæ­¤å¤„ç¼ºå°‘è§£å†³æ–¹æ¡ˆï¼‰",
     new_text="é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€å¯¼è‡´ OOM...\n\n**è§£å†³æ–¹æ¡ˆ**ï¼šè®¾ç½® maxmemory ä¸ºç‰©ç†å†…å­˜çš„ 75%ï¼Œé…åˆ allkeys-lfu æ·˜æ±°ç­–ç•¥ï¼Œå¹¶æ·»åŠ å†…å­˜ä½¿ç”¨ç‡ç›‘æ§å‘Šè­¦ï¼ˆé˜ˆå€¼ 80%ï¼‰ã€‚",
     version=5
   )
   â†’ æˆåŠŸï¼Œversion å˜ä¸º 6

â‘¤ åç«¯è‡ªåŠ¨å¤„ç†ï¼š
   - æ›´æ–°å®Œæ•´æ–‡æ¡£å†…å®¹
   - é‡ç®—è¡Œå·æ˜ å°„
   - å¼‚æ­¥æ›´æ–° section 2 çš„ embedding
   - å†™å…¥ agent_log: "æ›´æ–°äº†'Redisç¼“å­˜ç­–ç•¥æ€»ç»“' - ä¸ºå†…å­˜æº¢å‡ºé—®é¢˜æ·»åŠ è§£å†³æ–¹æ¡ˆ"

â‘¥ å‰ç«¯åº•éƒ¨æ—¥å¿—æ¡æ»šåŠ¨ï¼š
   "ğŸ”µ [14:32] AI æ›´æ–°äº† 'Redisç¼“å­˜ç­–ç•¥æ€»ç»“' - ä¸ºå†…å­˜æº¢å‡ºé—®é¢˜æ·»åŠ è§£å†³æ–¹æ¡ˆ"
```

---

## å…­ã€MCP Server è®¾è®¡

### 6.1 æ¶æ„å…³ç³»

```
MCP Client (Cursor/Claude ç­‰ Agent)
    â”‚
    â”‚ MCP åè®®ï¼ˆstdio / SSEï¼‰
    â–¼
MCP Serverï¼ˆç‹¬ç«‹ Node.js è¿›ç¨‹ï¼‰
    â”‚  é…ç½®æ–‡ä»¶ä¸­å¡«å…¥ç”¨æˆ·çš„ API Key
    â”‚
    â”‚ HTTP è°ƒç”¨ï¼ˆHeader: Authorization: Bearer nb_sk_xxxï¼‰
    â–¼
Next.js API Routesï¼ˆ/api/*ï¼‰
    â”‚  ä¸­é—´ä»¶ï¼šè¯†åˆ« Bearer token â†’ SHA-256 â†’ æŸ¥ api_keys è¡¨ â†’ è·å– user_id
    â”‚
    â”‚ Prisma ORMï¼ˆæ‰€æœ‰æŸ¥è¯¢è‡ªåŠ¨ WHERE user_id = å½“å‰ç”¨æˆ·ï¼‰
    â–¼
PostgreSQL + pgvector
```

MCP Server åªåšåè®®é€‚é…å’Œ tool ç¼–æ’ï¼Œæ‰€æœ‰ä¸šåŠ¡é€»è¾‘é›†ä¸­åœ¨ Next.js API å±‚ã€‚
æ¯ä¸ªç”¨æˆ·åœ¨å‰ç«¯ã€Œä¸ªäººè®¾ç½®ã€ä¸­ç”Ÿæˆè‡ªå·±çš„ API Keyï¼Œé…ç½®åˆ° MCP Client å³å¯ã€‚

### 6.2 Tools æ¸…å•

#### æœç´¢ä¸å®šä½

**`entries_search`** â€” æ··åˆæ£€ç´¢æ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "query": "string (å¿…å¡«ï¼Œè‡ªç„¶è¯­è¨€æŸ¥è¯¢)",
  "filters": {
    "notebook_id": "string? (ç¬”è®°æœ¬ ID)",
    "tags": ["string[]? (æ ‡ç­¾åæ•°ç»„)"],
    "type": "note | diary | experience | document (å¯é€‰)",
    "date_from": "string? (ISO dateï¼Œå¦‚ 2026-01-01)",
    "date_to": "string? (ISO date)",
    "source": "manual | agent (å¯é€‰)"
  },
  "limit": "number? (é»˜è®¤ 5ï¼Œæœ€å¤§ 20)",
  "search_mode": "hybrid | semantic | keyword (é»˜è®¤ hybrid)"
}
```

è¿”å›ï¼š
```json
{
  "results": [
    {
      "id": "uuid",
      "title": "Redisç¼“å­˜ç­–ç•¥æ€»ç»“",
      "summary": "é¡¹ç›®ä¸­é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¼“å­˜ç­–ç•¥é€‰å‹ä¸è¸©å‘...",
      "tags": ["redis", "ç¼“å­˜", "æ¶æ„"],
      "notebook": { "id": "uuid", "name": "å·¥ä½œç¬”è®°" },
      "type": "experience",
      "source": "manual",
      "updated_at": "2026-02-01T10:00:00Z",
      "relevance_score": 0.87,
      "matched_section": "## è¸©å‘è®°å½•\nå†…å­˜æº¢å‡ºé—®é¢˜åœ¨é«˜å¹¶å‘ä¸‹...",
      "word_count": 3200
    }
  ],
  "total_count": 12
}
```

**`entries_list`** â€” çº¯å…ƒæ•°æ®åˆ—è¡¨ï¼ˆä¸èµ°å‘é‡ï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "notebook_id": "string?",
  "tags": ["string[]?"],
  "type": "string?",
  "sort_by": "updated_at | created_at | title (é»˜è®¤ updated_at)",
  "sort_order": "asc | desc (é»˜è®¤ desc)",
  "page": "number? (é»˜è®¤ 1)",
  "page_size": "number? (é»˜è®¤ 20)"
}
```

#### è¯»å–

**`entry_get`** â€” è·å–æ–‡æ¡£ï¼ˆæ”¯æŒå…¨æ–‡ / å¤§çº² / åˆ†é¡µä¸‰ç§æ¨¡å¼ï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "mode": "full | outline (å¯é€‰ï¼ŒçŸ­æ–‡æ¡£è‡ªåŠ¨ fullï¼Œé•¿æ–‡æ¡£è‡ªåŠ¨ outline)",
  "offset": "number? (èµ·å§‹è¡Œå·ï¼Œä» 1 å¼€å§‹ã€‚ä¼ å…¥æ—¶å¿½ç•¥ modeï¼Œç›´æ¥è¿”å›æŒ‡å®šè¡ŒèŒƒå›´)",
  "limit": "number? (è¯»å–è¡Œæ•°ï¼Œé»˜è®¤ 100ã€‚éœ€é…åˆ offset ä½¿ç”¨)"
}
```

**æ¨¡å¼ 1ï¼šmode=fullï¼ˆçŸ­æ–‡æ¡£è‡ªåŠ¨è§¦å‘ï¼‰**
```json
{
  "id": "uuid",
  "title": "string",
  "content": "å®Œæ•´ markdown æ­£æ–‡",
  "summary": "æ‘˜è¦",
  "tags": ["string[]"],
  "notebook": { "id": "uuid", "name": "string" },
  "type": "string",
  "source": "string",
  "version": 5,
  "word_count": 800,
  "total_lines": 42,
  "relations": [
    {
      "relation_id": "uuid",
      "target_id": "uuid",
      "target_title": "TTLç­–ç•¥ç¬”è®°",
      "type": "references",
      "direction": "outgoing"
    }
  ],
  "created_at": "ISO datetime",
  "updated_at": "ISO datetime"
}
```

**æ¨¡å¼ 2ï¼šmode=outlineï¼ˆé•¿æ–‡æ¡£è‡ªåŠ¨è§¦å‘ï¼‰**
```json
{
  "id": "uuid",
  "title": "string",
  "summary": "æ‘˜è¦",
  "tags": ["string[]"],
  "notebook": { "id": "uuid", "name": "string" },
  "type": "string",
  "source": "string",
  "version": 5,
  "word_count": 5200,
  "total_lines": 105,
  "sections": [
    { "index": 0, "heading": "èƒŒæ™¯",     "line_start": 3,  "line_end": 15,  "word_count": 120 },
    { "index": 1, "heading": "æ–¹æ¡ˆé€‰å‹",  "line_start": 16, "line_end": 58,  "word_count": 800 },
    { "index": 2, "heading": "è¸©å‘è®°å½•",  "line_start": 59, "line_end": 92,  "word_count": 500 },
    { "index": 3, "heading": "ç»“è®º",     "line_start": 93, "line_end": 105, "word_count": 200 }
  ],
  "relations": [],
  "created_at": "ISO datetime",
  "updated_at": "ISO datetime"
}
```

**æ¨¡å¼ 3ï¼šoffset + limitï¼ˆåˆ†é¡µè¯»å–æŒ‡å®šè¡ŒèŒƒå›´ï¼‰**

è°ƒç”¨ `entry_get(id, offset=59, limit=34)` è¿”å›ï¼š
```json
{
  "id": "uuid",
  "title": "Redisç¼“å­˜ç­–ç•¥æ€»ç»“",
  "version": 5,
  "total_lines": 105,
  "showing": { "offset": 59, "limit": 34, "has_more": true },
  "content": "59| ## è¸©å‘è®°å½•\n60| \n61| ### 1. å†…å­˜æº¢å‡º\n62| é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€å¯¼è‡´ OOM...\n...\n92| æœ€ç»ˆé€šè¿‡ç›‘æ§å‘Šè­¦è§£å†³ã€‚"
}
```

å†…å®¹æ¯è¡Œå¸¦è¡Œå·å‰ç¼€ï¼ˆ`è¡Œå·| å†…å®¹`ï¼‰ï¼ŒAgent å¯ä»¥ç²¾ç¡®çŸ¥é“æ¯è¡Œåœ¨æ–‡æ¡£ä¸­çš„ä½ç½®ã€‚

**`entry_get_section`** â€” æŒ‰ section åºå·è¯»å–ï¼ˆentry_get offset+limit çš„è¯­æ³•ç³–ï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "section_index": "number (å¿…å¡«ï¼Œsection åºå·ï¼Œä»å¤§çº²çš„ sections åˆ—è¡¨è·å–)"
}
```

è¿”å›ï¼š
```json
{
  "heading": "è¸©å‘è®°å½•",
  "section_index": 2,
  "line_start": 59,
  "line_end": 92,
  "content": "59| ## è¸©å‘è®°å½•\n60| \n61| ### 1. å†…å­˜æº¢å‡º\n62| é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€...\n...\n92| æœ€ç»ˆé€šè¿‡ç›‘æ§å‘Šè­¦è§£å†³ã€‚",
  "word_count": 500
}
```

å†…éƒ¨ç­‰ä»·äº `entry_get(id, offset=sections[2].line_start, limit=sections[2].line_end - sections[2].line_start + 1)`ã€‚

#### å†™å…¥

**`entry_create`** â€” åˆ›å»ºæ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "title": "string (å¿…å¡«)",
  "content": "string (å¿…å¡«ï¼Œmarkdown æ­£æ–‡)",
  "notebook_id": "string? (ä¸ä¼ åˆ™æ”¾å…¥é»˜è®¤ç¬”è®°æœ¬)",
  "tags": ["string[]? (æ ‡ç­¾åæ•°ç»„ï¼Œä¸å­˜åœ¨çš„æ ‡ç­¾è‡ªåŠ¨åˆ›å»º)"],
  "type": "note | diary | experience | document (é»˜è®¤ note)",
  "summary": "string? (ä¸ä¼ åˆ™è‡ªåŠ¨ç”Ÿæˆ)",
  "metadata": "object? (æ‰©å±•å…ƒæ•°æ®)"
}
```

è¿”å›ï¼š
```json
{
  "id": "uuid",
  "title": "string",
  "version": 1,
  "created_at": "ISO datetime"
}
```

**`entry_update`** â€” æ›´æ–°æ–‡æ¡£ï¼ˆæ•´ç¯‡æˆ–å­—æ®µï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "title": "string?",
  "content": "string? (ä¼ åˆ™æ•´ç¯‡æ›¿æ¢)",
  "summary": "string?",
  "tags": ["string[]? (ä¼ åˆ™æ•´ä½“æ›¿æ¢æ ‡ç­¾)"],
  "notebook_id": "string?",
  "type": "string?",
  "version": "number (å¿…å¡«ï¼Œä¹è§‚é”)"
}
```

è¿”å›ï¼š
```json
{
  "id": "uuid",
  "version": 6,
  "updated_at": "ISO datetime"
}
```

**`entry_append`** â€” è¿½åŠ å†…å®¹åˆ°æ–‡æ¡£æœ«å°¾

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "content": "string (å¿…å¡«ï¼Œè¿½åŠ çš„ markdown å†…å®¹)",
  "version": "number (å¿…å¡«)"
}
```

**`entry_update_section`** â€” æ›´æ–°æ–‡æ¡£çš„æŸä¸ª section

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "section_index": "number (å¿…å¡«)",
  "content": "string (å¿…å¡«ï¼Œè¯¥ section çš„æ–°å†…å®¹)",
  "version": "number (å¿…å¡«)"
}
```

**`entry_replace`** â€” ç²¾ç¡®æ–‡æœ¬æ›¿æ¢ï¼ˆç±»ä¼¼ Cursor çš„ StrReplaceï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "old_text": "string (å¿…å¡«ï¼Œè¦æ›¿æ¢çš„åŸæ–‡ã€‚å¿…é¡»åœ¨æ–‡æ¡£ä¸­å”¯ä¸€åŒ¹é…ï¼Œå¦åˆ™æŠ¥é”™)",
  "new_text": "string (å¿…å¡«ï¼Œæ›¿æ¢åçš„å†…å®¹ã€‚ä¼ ç©ºå­—ç¬¦ä¸²åˆ™è¡¨ç¤ºåˆ é™¤è¯¥æ®µ)",
  "version": "number (å¿…å¡«ï¼Œä¹è§‚é”)"
}
```

è¿”å›ï¼š
```json
{
  "id": "uuid",
  "version": 6,
  "updated_at": "ISO datetime",
  "change_stats": { "added_lines": 3, "removed_lines": 1 }
}
```

è¯´æ˜ï¼š
- `old_text` å¿…é¡»ç²¾ç¡®åŒ¹é…ï¼ˆåŒ…æ‹¬æ¢è¡Œå’Œç©ºæ ¼ï¼‰ï¼Œä¸”åœ¨æ–‡æ¡£ä¸­åªå‡ºç°ä¸€æ¬¡
- å¦‚æœåŒ¹é…åˆ° 0 æ¬¡ â†’ è¿”å›é”™è¯¯ "æœªæ‰¾åˆ°åŒ¹é…æ–‡æœ¬"
- å¦‚æœåŒ¹é…åˆ°å¤šæ¬¡ â†’ è¿”å›é”™è¯¯ "åŒ¹é…åˆ°å¤šå¤„ï¼Œè¯·æä¾›æ›´é•¿çš„ä¸Šä¸‹æ–‡ä»¥å”¯ä¸€å®šä½"
- Agent åº”å…ˆç”¨ `entry_get(offset, limit)` çœ‹åˆ°å¸¦è¡Œå·çš„å†…å®¹ï¼Œå†ç²¾ç¡®æ‹·è´ `old_text`

**`entry_delete`** â€” åˆ é™¤æ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)"
}
```

#### å…³è”

**`entry_relations_list`** â€” æŸ¥çœ‹æŸæ–‡æ¡£çš„æ‰€æœ‰å…³è”

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)"
}
```

è¿”å›ï¼š
```json
{
  "relations": [
    {
      "relation_id": "uuid",
      "target_id": "uuid",
      "target_title": "TTLç­–ç•¥ç¬”è®°",
      "target_summary": "å…³äº Redis TTL çš„...",
      "type": "references",
      "direction": "outgoing",
      "created_at": "ISO datetime"
    }
  ]
}
```

**`entry_relation_create`** â€” å»ºç«‹å…³è”

è¾“å…¥å‚æ•°ï¼š
```json
{
  "from_id": "string (å¿…å¡«)",
  "to_id": "string (å¿…å¡«)",
  "type": "references | continues | related | contradicts | summarizes (å¿…å¡«)"
}
```

**`entry_relation_delete`** â€” åˆ é™¤å…³è”

è¾“å…¥å‚æ•°ï¼š
```json
{
  "relation_id": "string (å¿…å¡«)"
}
```

**`entry_find_related`** â€” åŸºäºå‘é‡ç›¸ä¼¼åº¦æ¨èç›¸å…³æ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "limit": "number? (é»˜è®¤ 5)"
}
```

è¿”å›ï¼šæ’é™¤å·²æœ‰æ˜¾å¼å…³è”çš„ã€è¯­ä¹‰æœ€ç›¸ä¼¼çš„ top-k æ–‡æ¡£åˆ—è¡¨ã€‚

#### ç¬”è®°æœ¬ç®¡ç†

**`notebooks_list`** â€” åˆ—å‡ºæ‰€æœ‰ç¬”è®°æœ¬

è¿”å›ï¼š
```json
{
  "notebooks": [
    {
      "id": "uuid",
      "name": "å·¥ä½œç¬”è®°",
      "description": "...",
      "icon": "ğŸ““",
      "entry_count": 23,
      "is_default": false,
      "created_at": "ISO datetime"
    }
  ]
}
```

**`notebook_create`** â€” åˆ›å»ºç¬”è®°æœ¬

è¾“å…¥å‚æ•°ï¼š
```json
{
  "name": "string (å¿…å¡«)",
  "description": "string?",
  "icon": "string? (emoji)"
}
```

**`notebook_update`** â€” æ›´æ–°ç¬”è®°æœ¬

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "name": "string?",
  "description": "string?",
  "icon": "string?"
}
```

**`notebook_delete`** â€” åˆ é™¤ç¬”è®°æœ¬ï¼ˆå…¶ä¸­çš„æ–‡æ¡£ç§»åˆ°é»˜è®¤ç¬”è®°æœ¬ï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)"
}
```

#### æ ‡ç­¾ç®¡ç†

**`tags_list`** â€” åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾åŠä½¿ç”¨æ¬¡æ•°

è¿”å›ï¼š
```json
{
  "tags": [
    { "id": "uuid", "name": "redis", "color": "#e74c3c", "count": 12 },
    { "id": "uuid", "name": "æ¶æ„", "color": "#3498db", "count": 8 }
  ]
}
```

### 6.3 Resourcesï¼ˆåªè¯»ä¸Šä¸‹æ–‡ï¼‰

Agent å¯åŠ¨æ—¶å¯ä»¥å…ˆè¯»è¿™äº› resourceï¼Œäº†è§£ç”¨æˆ·çš„ç¬”è®°æœ¬ç»“æ„ï¼š

| URI | è¯´æ˜ |
|-----|------|
| `notebooks` | å½“å‰ç”¨æˆ·çš„ç¬”è®°æœ¬åˆ—è¡¨ï¼ˆåç§°ã€æ–‡æ¡£æ•°ï¼‰ |
| `tags` | å½“å‰ç”¨æˆ·çš„æ ‡ç­¾åˆ—è¡¨ï¼ˆåç§°ã€ä½¿ç”¨æ¬¡æ•°ï¼‰ |
| `recent_entries` | æœ€è¿‘æ›´æ–°çš„ 10 ç¯‡æ–‡æ¡£æ‘˜è¦ï¼ˆæ ‡é¢˜ + æ‘˜è¦ + æ ‡ç­¾ + æ›´æ–°æ—¶é—´ï¼‰ |
| `entry/{id}/context` | æŸç¯‡æ–‡æ¡£çš„æ‘˜è¦ + æ ‡ç­¾ + å…³è”åˆ—è¡¨ï¼ˆä¾¿äº Agent å†³ç­–ï¼‰ |

### 6.4 Agent æ“ä½œçš„å…¸å‹æµç¨‹

**åœºæ™¯ Aï¼šä¿®æ”¹é•¿æ–‡æ¡£çš„æŸå‡ è¡Œï¼ˆç²¾ç¡®æ›¿æ¢ï¼Œæ¨èæ–¹å¼ï¼‰**
```
â‘  entries_search(query="è¶…æ—¶é‡è¯•", filters={date_from:"7å¤©å‰"})
   â†’ è¿”å› top-3 å€™é€‰ï¼Œå‘½ä¸­ "HTTPè¯·æ±‚å¤±è´¥å¤„ç†æ–¹æ¡ˆ"ï¼ˆ5200å­—ï¼‰

â‘¡ entry_get(id="abc")
   â†’ é•¿æ–‡æ¡£ï¼Œè‡ªåŠ¨è¿”å›å¤§çº²ï¼š
     section 0: "èƒŒæ™¯"       lines 3-15    (120å­—)
     section 1: "æ–¹æ¡ˆé€‰å‹"    lines 16-58   (800å­—)
     section 2: "è¸©å‘è®°å½•"    lines 59-92   (500å­—)  â† ç›®æ ‡
     section 3: "ç»“è®º"       lines 93-105  (200å­—)

â‘¢ entry_get(id="abc", offset=59, limit=34)
   â†’ è¿”å›ç¬¬ 59-92 è¡Œï¼ˆå¸¦è¡Œå·ï¼‰ï¼š
     59| ## è¸©å‘è®°å½•
     60|
     61| ### 1. å†…å­˜æº¢å‡º
     62| é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€å¯¼è‡´ OOM...
     ...

â‘£ entry_replace(
     id="abc",
     old_text="é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€å¯¼è‡´ OOM...",
     new_text="é«˜å¹¶å‘ä¸‹ç¼“å­˜è†¨èƒ€å¯¼è‡´ OOM...\n\n**è§£å†³æ–¹æ¡ˆ**ï¼šè®¾ç½® maxmemory + allkeys-lfuã€‚",
     version=5
   )
   â†’ version å˜ä¸º 6ï¼Œå¼‚æ­¥æ›´æ–° embeddingï¼Œå†™å…¥ agent_logs
```

**åœºæ™¯ Bï¼šé‡å†™æŸä¸ª sectionï¼ˆæ•´æ®µæ›¿æ¢ï¼‰**
```
â‘  entry_get(id="abc")  â†’ å¤§çº²
â‘¡ entry_get_section(id="abc", section_index=2)  â†’ "è¸©å‘è®°å½•" å®Œæ•´å†…å®¹
â‘¢ Agent é‡å†™æ•´æ®µå†…å®¹
â‘£ entry_update_section(id="abc", section_index=2, content="æ–°å†…å®¹", version=5)
```

**åœºæ™¯ï¼šåˆ›å»ºæ–°æ–‡æ¡£å¹¶å»ºç«‹å…³è”**
```
â‘  notebooks_list() â†’ äº†è§£æœ‰å“ªäº›ç¬”è®°æœ¬
â‘¡ entry_create(title="...", content="...", notebook_id="å·¥ä½œ", tags=["redis"])
   â†’ è¿”å› { id: "new-id" }
â‘¢ entries_search(query="ç›¸å…³ä¸»é¢˜") â†’ æ‰¾åˆ°å·²æœ‰æ–‡æ¡£
â‘£ entry_relation_create(from_id="new-id", to_id="related-id", type="continues")
```

---

## ä¸ƒã€å‰ç«¯é¡µé¢è®¾è®¡

### 7.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€[Logo]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ” æœç´¢æ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [é€šçŸ¥ğŸ””] [å¤´åƒğŸ‘¤]â”€â”
â”‚                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                                                         â”‚
â”‚ ä¾§è¾¹æ     â”‚              ä¸»å†…å®¹åŒº                                    â”‚
â”‚ (å¯æŠ˜å )  â”‚   (æ ¹æ®è·¯ç”±åˆ‡æ¢ï¼šæ–‡æ¡£åˆ—è¡¨ / æ–‡æ¡£è¯¦æƒ… / æœç´¢ç»“æœ)           â”‚
â”‚          â”‚                                                         â”‚
â”‚ ğŸ““ ç¬”è®°æœ¬  â”‚                                                         â”‚
â”‚  å…¨éƒ¨ç¬”è®°  â”‚                                                         â”‚
â”‚  â”œ å·¥ä½œ   â”‚                                                         â”‚
â”‚  â”œ å­¦ä¹    â”‚                                                         â”‚
â”‚  â”” é¡¹ç›®X  â”‚                                                         â”‚
â”‚  [+æ–°å»º]  â”‚                                                         â”‚
â”‚          â”‚                                                         â”‚
â”‚ ğŸ· æ ‡ç­¾    â”‚                                                         â”‚
â”‚  redis(5) â”‚                                                         â”‚
â”‚  æ¶æ„(3)  â”‚                                                         â”‚
â”‚  docker(2)â”‚                                                         â”‚
â”‚          â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ Agent æ“ä½œæ—¥å¿—æ»šåŠ¨æ¡                                 [æŸ¥çœ‹å…¨éƒ¨ â†’] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é¡¶éƒ¨å¯¼èˆªæ 

- **å·¦ä¾§**ï¼šLogo + äº§å“å "NoteBrain"
- **ä¸­é—´**ï¼šå…¨å±€æœç´¢æ ï¼Œå¸¸é©»
  - è¾“å…¥æ–‡å­—å 300ms é˜²æŠ–è§¦å‘æœç´¢
  - ä¸‹æ‹‰å±•ç¤ºæœç´¢ç»“æœé¢„è§ˆï¼ˆæœ€å¤š 5 æ¡ï¼šæ ‡é¢˜ + å‘½ä¸­ç‰‡æ®µï¼‰
  - å›è½¦è¿›å…¥å®Œæ•´æœç´¢ç»“æœé¡µ
  - æ”¯æŒå¿«æ·è¯­æ³•ï¼š`#redis` è‡ªåŠ¨è¯†åˆ«ä¸ºæ ‡ç­¾è¿‡æ»¤ï¼Œ`@å·¥ä½œ` è¯†åˆ«ä¸ºç¬”è®°æœ¬è¿‡æ»¤
- **å³ä¾§**ï¼š
  - ğŸ”” é€šçŸ¥é“ƒé“›ï¼šAgent æ“ä½œå®Œæˆçš„é€šçŸ¥
  - ğŸ‘¤ å¤´åƒï¼šç‚¹å‡»å±•å¼€ä¸‹æ‹‰èœå•
    - ç”¨æˆ·å + é‚®ç®±
    - ä¸ªäººè®¾ç½®ï¼ˆâ†’ è¿›å…¥è®¾ç½®é¡µï¼Œå« MCP Key ç®¡ç†ã€ä¸»é¢˜åˆ‡æ¢ç­‰ï¼‰
    - æ•°æ®ç»Ÿè®¡ï¼ˆæ–‡æ¡£æ€»æ•°ã€æ ‡ç­¾æ•°ã€å­˜å‚¨ç”¨é‡ï¼‰
    - é€€å‡ºç™»å½•

### 7.3 ä¾§è¾¹æ 

- å¯æŠ˜å ï¼ˆç‚¹å‡» hamburger å›¾æ ‡ æˆ– å¿«æ·é”®ï¼‰
- **ç¬”è®°æœ¬åŒºåŸŸ**ï¼š
  - "å…¨éƒ¨ç¬”è®°" å…¥å£ï¼ˆæ˜¾ç¤ºæ‰€æœ‰æ–‡æ¡£åˆ—è¡¨ï¼‰
  - å„ç¬”è®°æœ¬åç§° + æ–‡æ¡£æ•°
  - å³é”®èœå•ï¼šé‡å‘½åã€å½’æ¡£ã€åˆ é™¤
  - åº•éƒ¨ [+ æ–°å»ºç¬”è®°æœ¬] æŒ‰é’®
- **æ ‡ç­¾åŒºåŸŸ**ï¼š
  - æ ‡ç­¾å + ä½¿ç”¨æ¬¡æ•°
  - ç‚¹å‡»æ ‡ç­¾ â†’ ä¸»å†…å®¹åŒºæ˜¾ç¤ºè¯¥æ ‡ç­¾ä¸‹çš„æ–‡æ¡£åˆ—è¡¨
  - æ ‡ç­¾å‰çš„è‰²ç‚¹è¡¨ç¤ºæ ‡ç­¾é¢œè‰²
- **æœ€è¿‘è®¿é—®**ï¼ˆå¯é€‰ï¼‰ï¼š
  - æœ€è¿‘æ‰“å¼€çš„ 5 ç¯‡æ–‡æ¡£å¿«æ·å…¥å£

### 7.4 æ–‡æ¡£åˆ—è¡¨é¡µ

é€‰ä¸­ç¬”è®°æœ¬æˆ–æ ‡ç­¾åæ˜¾ç¤ºï¼š

```
â”Œâ”€ å·¥ä½œç¬”è®° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [æ’åº: æœ€è¿‘æ›´æ–°â–¼] [+ æ–°å»º] â”€â”
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“„ Redisç¼“å­˜ç­–ç•¥æ€»ç»“                                      â”‚  â”‚
â”‚  â”‚ é¡¹ç›®ä¸­é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¼“å­˜ç­–ç•¥é€‰å‹ä¸è¸©å‘è®°å½•...                  â”‚  â”‚
â”‚  â”‚ ğŸ· redis  ç¼“å­˜  æ¶æ„    ğŸ“Š ç»éªŒ    ğŸ¤– AIæ›´æ–°äº2å°æ—¶å‰       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“„ Docker Compose éƒ¨ç½²æŒ‡å—                                â”‚  â”‚
â”‚  â”‚ ä½¿ç”¨ docker compose éƒ¨ç½²å¾®æœåŠ¡çš„å®Œæ•´æµç¨‹å’Œæ³¨æ„äº‹é¡¹...         â”‚  â”‚
â”‚  â”‚ ğŸ· docker  éƒ¨ç½²    ğŸ“Š æ–‡æ¡£    ğŸ¤– AIåˆ›å»ºäº3å°æ—¶å‰            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å…± 23 ç¯‡  [1] 2 3 â–¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

äº¤äº’ç»†èŠ‚ï¼š
- åˆ—è¡¨é¡¹ hover â†’ å³ä¾§æµ®ç°å¿«æ·æ“ä½œæŒ‰é’®ï¼ˆç¼–è¾‘ã€ç§»åŠ¨ã€åˆ é™¤ï¼‰
- æ¥æºæ ‡è®°ï¼šğŸ¤– AIæ›´æ–°äº... vs âœï¸ æ‰‹åŠ¨ç¼–è¾‘äº...
- ç‚¹å‡» â†’ è¿›å…¥æ–‡æ¡£è¯¦æƒ…é¡µ
- æ‰¹é‡æ“ä½œï¼šå·¦ä¾§ checkboxï¼Œé€‰ä¸­åé¡¶éƒ¨å‡ºç°æ‰¹é‡æ“ä½œæ ï¼ˆæ‰“æ ‡ç­¾ã€ç§»åŠ¨ç¬”è®°æœ¬ã€åˆ é™¤ï¼‰
- æ’åºé€‰é¡¹ï¼šæœ€è¿‘æ›´æ–°ã€æœ€è¿‘åˆ›å»ºã€æ ‡é¢˜å­—æ¯åº
- [+ æ–°å»º] æŒ‰é’® â†’ åˆ›å»ºæ–°æ–‡æ¡£ï¼ˆè¿›å…¥ç¼–è¾‘å™¨é¡µé¢ï¼Œè‡ªåŠ¨å½’å…¥å½“å‰ç¬”è®°æœ¬ï¼‰

### 7.5 æ–‡æ¡£è¯¦æƒ…é¡µï¼ˆæ ¸å¿ƒé¡µé¢ï¼‰

```
â”Œâ”€ [â† è¿”å›åˆ—è¡¨]  å·¥ä½œç¬”è®° / Redisç¼“å­˜ç­–ç•¥æ€»ç»“ â”€â”€â”€ [ç¼–è¾‘âœï¸] [Â·Â·Â·] â”€â”
â”‚                                                                   â”‚
â”‚  â”Œâ”€ å…ƒæ•°æ®åŒº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ· redis  ç¼“å­˜  æ¶æ„  [+ æ·»åŠ æ ‡ç­¾]                           â”‚  â”‚
â”‚  â”‚ ğŸ“Š ç±»å‹: ç»éªŒ  â”‚  ğŸ““ ç¬”è®°æœ¬: å·¥ä½œ  â”‚  ğŸ“… æ›´æ–°: 2026-02-08   â”‚  â”‚
â”‚  â”‚ ğŸ¤– æœ€åç”± AI æ›´æ–°äº 2 å°æ—¶å‰  â”‚  ç‰ˆæœ¬ #5  [æŸ¥çœ‹å†å²]          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ æ­£æ–‡åŒºï¼ˆMarkdown æ¸²æŸ“ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  # Redisç¼“å­˜ç­–ç•¥æ€»ç»“                                         â”‚  â”‚
â”‚  â”‚  ## èƒŒæ™¯                                                     â”‚  â”‚
â”‚  â”‚  é¡¹ç›®ä¸­é‡åˆ°äº†é«˜å¹¶å‘è¯»å–çš„é—®é¢˜...                               â”‚  â”‚
â”‚  â”‚  ## æ–¹æ¡ˆé€‰å‹                                                  â”‚  â”‚
â”‚  â”‚  ...                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ å…³è”æ–‡æ¡£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [+ æ·»åŠ å…³è”] â”€â”  â”‚
â”‚  â”‚  å¼•ç”¨ â†’   ğŸ“„ TTLè¿‡æœŸç­–ç•¥ç¬”è®°                                  â”‚  â”‚
â”‚  â”‚  è¢«å¼•ç”¨ â† ğŸ“„ ç”µå•†ç³»ç»Ÿæ¶æ„è®¾è®¡                                  â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  ğŸ’¡ AI å»ºè®®å…³è”ï¼š                                             â”‚  â”‚
â”‚  â”‚     ğŸ“„ Memcached vs Rediså¯¹æ¯” (ç›¸ä¼¼åº¦ 89%)    [å»ºç«‹å…³è”] [å¿½ç•¥]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å³ä¸Šè§’ `[Â·Â·Â·]` ä¸‹æ‹‰èœå•ï¼š
- ç§»åŠ¨åˆ°å…¶ä»–ç¬”è®°æœ¬
- å¯¼å‡ºä¸º Markdown æ–‡ä»¶
- å¤åˆ¶åˆ†äº«é“¾æ¥
- æŸ¥çœ‹ç‰ˆæœ¬å†å²
- åˆ é™¤æ–‡æ¡£

ç¼–è¾‘æ¨¡å¼ï¼š
- ç‚¹å‡» [ç¼–è¾‘] â†’ æ­£æ–‡åŒºåˆ‡æ¢ä¸º Markdown ç¼–è¾‘å™¨ï¼ˆMilkdown æ‰€è§å³æ‰€å¾—ï¼‰
- è‡ªåŠ¨ä¿å­˜ï¼ˆdebounce 2 ç§’ï¼‰+ æ‰‹åŠ¨ä¿å­˜æŒ‰é’®
- ä¿å­˜æ—¶ version + 1ï¼Œåç«¯å¼‚æ­¥æ›´æ–° embedding
- ç¼–è¾‘å™¨å·¥å…·æ ï¼šç²—ä½“ã€æ–œä½“ã€æ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç å—ã€é“¾æ¥ã€å›¾ç‰‡

ç‰ˆæœ¬å†å²å¼¹çª—ï¼š
- ç‰ˆæœ¬åˆ—è¡¨ï¼šç‰ˆæœ¬å· + æ—¶é—´ + æ¥æºï¼ˆAI/æ‰‹åŠ¨ï¼‰+ å˜æ›´è¯´æ˜
- [æ¢å¤] æŒ‰é’®ï¼šæ¢å¤åˆ°è¯¥ç‰ˆæœ¬
- [å¯¹æ¯”] æŒ‰é’®ï¼šæ‰“å¼€ diff è§†å›¾ï¼Œå·¦å³å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬

### 7.6 æœç´¢ç»“æœé¡µ

```
â”Œâ”€ æœç´¢ç»“æœï¼š"æ¥å£è¶…æ—¶é‡è¯•" â”€â”€â”€â”€â”€â”€â”€ å…± 8 æ¡ç»“æœ â”€â”€â”€â”€ [ç­›é€‰é¢æ¿â–¼] â”€â”
â”‚                                                                â”‚
â”‚  â”Œâ”€ ç­›é€‰æ¡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç¬”è®°æœ¬: [å…¨éƒ¨â–¼]  æ ‡ç­¾: [é€‰æ‹©â–¼]  ç±»å‹: [å…¨éƒ¨â–¼]  æ—¶é—´: [ä¸é™â–¼]â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“„ HTTPè¯·æ±‚å¤±è´¥å¤„ç†æ–¹æ¡ˆ                     ç›¸å…³åº¦: 92%     â”‚â”‚
â”‚  â”‚ "...é‡‡ç”¨ exponential backoff ç­–ç•¥è¿›è¡Œé‡è¯•ï¼Œ                 â”‚â”‚
â”‚  â”‚  å½“è¿ç»­è¶…æ—¶3æ¬¡åè§¦å‘ç†”æ–­æœºåˆ¶..."                              â”‚â”‚
â”‚  â”‚ ğŸ· http  å¼‚å¸¸å¤„ç†    ğŸ““ å·¥ä½œ    ğŸ“… 2026-02-05              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â”‚  ...æ›´å¤šç»“æœ...                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

äº¤äº’ç»†èŠ‚ï¼š
- å‘½ä¸­ç‰‡æ®µä¸­å…³é”®è¯åŠ ç²—é«˜äº®
- æ˜¾ç¤ºç›¸å…³åº¦åˆ†æ•°
- ç­›é€‰é¢æ¿å¯å±•å¼€/æŠ˜å 
- ç‚¹å‡»ç»“æœ â†’ è¿›å…¥æ–‡æ¡£è¯¦æƒ…é¡µï¼Œè‡ªåŠ¨å®šä½åˆ°å‘½ä¸­çš„ section

### 7.7 Agent æ“ä½œæ—¥å¿—

**åº•éƒ¨æ»šåŠ¨æ¡ï¼ˆé»˜è®¤çŠ¶æ€ï¼‰**ï¼š
- å›ºå®šåœ¨é¡µé¢åº•éƒ¨ï¼Œé«˜åº¦çº¦ 40px
- æ—¥å¿—æ¡ç›®ä»ä¸‹å¾€ä¸Šæ»šåŠ¨ï¼ˆåƒå¹¿å‘Šç¿»ç‰Œï¼‰ï¼Œæ¯æ¡åœç•™ 3 ç§’
- æ¯æ¡æ ¼å¼ï¼š`[æ—¶é—´] AI åŠ¨ä½œæè¿° - æ–‡æ¡£åç§°`
- åŠ¨ä½œç±»å‹é¢œè‰²æ ‡è®°ï¼š
  - ğŸŸ¢ åˆ›å»ºï¼ˆç»¿è‰²ï¼‰
  - ğŸ”µ æ›´æ–°ï¼ˆè“è‰²ï¼‰
  - ğŸŸ¡ æ·»åŠ æ ‡ç­¾/å…³è”ï¼ˆé»„è‰²ï¼‰
  - ğŸ”´ åˆ é™¤ï¼ˆçº¢è‰²ï¼‰
- é¼ æ ‡ hover æ—¶æš‚åœæ»šåŠ¨
- ç‚¹å‡»æŸæ¡æ—¥å¿— â†’ è·³è½¬åˆ°å¯¹åº”æ–‡æ¡£
- å³ä¾§ [æŸ¥çœ‹å…¨éƒ¨ â†’] æŒ‰é’®

**å®Œæ•´æ—¥å¿—é¡µé¢/æŠ½å±‰**ï¼ˆç‚¹å‡» [æŸ¥çœ‹å…¨éƒ¨] åï¼‰ï¼š
- æŒ‰æ—¥æœŸåˆ†ç»„ï¼šä»Šå¤©ã€æ˜¨å¤©ã€æ›´æ—©...
- æ¯æ¡æ—¥å¿—æ˜¾ç¤ºï¼š
  - åŠ¨ä½œå›¾æ ‡ + é¢œè‰²
  - æ—¶é—´
  - æ“ä½œæè¿°
  - å˜æ›´ç»Ÿè®¡ï¼ˆå¦‚ +156 å­—ï¼‰
  - [æŸ¥çœ‹æ–‡æ¡£] [å¯¹æ¯”] æ“ä½œæŒ‰é’®
- æ”¯æŒç­›é€‰ï¼šæŒ‰åŠ¨ä½œç±»å‹ã€æŒ‰æ–‡æ¡£
- åº•éƒ¨æç¤ºï¼šæ—¥å¿—ä¿ç•™ 30 å¤©ï¼Œæ›´æ—©çš„å·²è‡ªåŠ¨æ¸…ç†

### 7.8 ä¸ªäººè®¾ç½®é¡µï¼ˆå« MCP Key ç®¡ç†ï¼‰

```
â”Œâ”€ ä¸ªäººè®¾ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  â”Œâ”€ ä¸ªäººä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¤´åƒ [æ›´æ¢]                                                â”‚  â”‚
â”‚  â”‚  ç”¨æˆ·åï¼š______                                             â”‚  â”‚
â”‚  â”‚  é‚®ç®±ï¼šuser@example.com                                     â”‚  â”‚
â”‚  â”‚                                                [ä¿å­˜ä¿®æ”¹]   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€ MCP API å¯†é’¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [+ ç”Ÿæˆæ–°å¯†é’¥] â”€â”€â”  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  ç”¨äºè¿æ¥ MCP Clientï¼ˆå¦‚ Cursorã€Claude Desktop ç­‰ï¼‰          â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ”‘ Cursor MCP                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ nb_sk_3aF8...  â”‚  åˆ›å»ºäº 2026-02-01  â”‚  æœ€åä½¿ç”¨ï¼š2å°æ—¶å‰ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                       [ç¦ç”¨] [åˆ é™¤]     â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ”‘ Claude Desktop                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ nb_sk_7xKm...  â”‚  åˆ›å»ºäº 2026-02-05  â”‚  æœ€åä½¿ç”¨ï¼š3å¤©å‰   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                       [ç¦ç”¨] [åˆ é™¤]     â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ”‘ æµ‹è¯•ç”¨ (å·²ç¦ç”¨)                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ nb_sk_9pLq...  â”‚  åˆ›å»ºäº 2026-01-20  â”‚  ä»æœªä½¿ç”¨          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                       [å¯ç”¨] [åˆ é™¤]     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€ å¤–è§‚è®¾ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ä¸»é¢˜ï¼š[æµ…è‰² â—‹] [æ·±è‰² â—] [è·Ÿéšç³»ç»Ÿ â—‹]                        â”‚  â”‚
â”‚  â”‚  è¯­è¨€ï¼š[ç®€ä½“ä¸­æ–‡ â–¼]                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€ æ•°æ®ç»Ÿè®¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ–‡æ¡£æ€»æ•°ï¼š47 ç¯‡  â”‚  ç¬”è®°æœ¬ï¼š5 ä¸ª  â”‚  æ ‡ç­¾ï¼š23 ä¸ª            â”‚  â”‚
â”‚  â”‚  å­˜å‚¨ç”¨é‡ï¼š12.3 MB  â”‚  å‘é‡ç´¢å¼•ï¼š8.5 MB                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**[+ ç”Ÿæˆæ–°å¯†é’¥] ç‚¹å‡»åçš„å¼¹çª—ï¼š**

```
â”Œâ”€ ç”Ÿæˆæ–°çš„ API å¯†é’¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  å¯†é’¥åç§°ï¼š[________________] ï¼ˆå¦‚ "Cursor MCP"ã€"åŠå…¬ç”µè„‘"ï¼‰      â”‚
â”‚                                                                  â”‚
â”‚  è¿‡æœŸæ—¶é—´ï¼š[æ°¸ä¸è¿‡æœŸ â–¼]                                           â”‚
â”‚            â”œ æ°¸ä¸è¿‡æœŸ                                             â”‚
â”‚            â”œ 30 å¤©å                                              â”‚
â”‚            â”œ 90 å¤©å                                              â”‚
â”‚            â”” è‡ªå®šä¹‰æ—¥æœŸ                                           â”‚
â”‚                                                                  â”‚
â”‚                                       [å–æ¶ˆ]  [ç”Ÿæˆ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç”ŸæˆæˆåŠŸåçš„å¼¹çª—ï¼ˆåªå±•ç¤ºä¸€æ¬¡ï¼‰ï¼š**

```
â”Œâ”€ âœ… å¯†é’¥å·²ç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  âš ï¸ è¯·ç«‹å³å¤åˆ¶å¹¶å¦¥å–„ä¿ç®¡ï¼Œæ­¤å¯†é’¥åªä¼šå±•ç¤ºä¸€æ¬¡ï¼                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ nb_sk_3aF8kL9mN2pQ4rS6tU8vW0xY1zA3bC5d                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                              [ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿]   â”‚
â”‚                                                                  â”‚
â”‚  MCP é…ç½®ç¤ºä¾‹ï¼š                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ {                                                         â”‚   â”‚
â”‚  â”‚   "mcpServers": {                                         â”‚   â”‚
â”‚  â”‚     "notebrain": {                                        â”‚   â”‚
â”‚  â”‚       "command": "npx",                                   â”‚   â”‚
â”‚  â”‚       "args": ["notebrain-mcp"],                          â”‚   â”‚
â”‚  â”‚       "env": {                                            â”‚   â”‚
â”‚  â”‚         "NOTEBRAIN_API_KEY": "nb_sk_3aF8kL9m...",         â”‚   â”‚
â”‚  â”‚         "NOTEBRAIN_API_URL": "https://your-domain/api"    â”‚   â”‚
â”‚  â”‚       }                                                   â”‚   â”‚
â”‚  â”‚     }                                                     â”‚   â”‚
â”‚  â”‚   }                                                       â”‚   â”‚
â”‚  â”‚ }                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚                                                     [å®Œæˆ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

äº¤äº’ç»†èŠ‚ï¼š
- æ¯ä¸ªç”¨æˆ·æœ€å¤šå¯ç”Ÿæˆ **10 ä¸ª** API å¯†é’¥ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
- ç¦ç”¨å¯†é’¥åï¼Œä½¿ç”¨è¯¥å¯†é’¥çš„ MCP è¯·æ±‚ä¼šç«‹å³è¿”å› 401
- åˆ é™¤å¯†é’¥éœ€è¦äºŒæ¬¡ç¡®è®¤å¼¹çª—
- åˆ—è¡¨æ˜¾ç¤º"æœ€åä½¿ç”¨æ—¶é—´"ï¼Œæ–¹ä¾¿è¯†åˆ«å“ªäº›å¯†é’¥åœ¨æ´»è·ƒä½¿ç”¨
- "ä»æœªä½¿ç”¨" æ ‡è®°å¸®åŠ©æ¸…ç†æ— ç”¨å¯†é’¥

---

## å…«ã€é¡¹ç›®ç›®å½•ç»“æ„

```
notebrain/
â”œâ”€â”€ app/                           # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                    # è®¤è¯ç›¸å…³é¡µé¢ï¼ˆç™»å½•/æ³¨å†Œï¼‰
â”‚   â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”‚   â””â”€â”€ register/page.tsx
â”‚   â”œâ”€â”€ (main)/                    # ç™»å½•åçš„ä¸»å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ layout.tsx             # ä¾§è¾¹æ  + é¡¶æ  + åº•éƒ¨æ—¥å¿—æ¡ çš„å£³
â”‚   â”‚   â”œâ”€â”€ page.tsx               # é¦–é¡µï¼ˆæœ€è¿‘æ–‡æ¡£ / ä»ªè¡¨ç›˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ notebooks/
â”‚   â”‚   â”‚   â””â”€â”€ [id]/page.tsx      # æŸç¬”è®°æœ¬çš„æ–‡æ¡£åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ entries/
â”‚   â”‚   â”‚   â”œâ”€â”€ new/page.tsx       # æ–°å»ºæ–‡æ¡£
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx       # æ–‡æ¡£è¯¦æƒ…ï¼ˆé˜…è¯»æ¨¡å¼ï¼‰
â”‚   â”‚   â”‚       â””â”€â”€ edit/page.tsx  # æ–‡æ¡£ç¼–è¾‘
â”‚   â”‚   â”œâ”€â”€ search/page.tsx        # æœç´¢ç»“æœé¡µ
â”‚   â”‚   â”œâ”€â”€ tags/
â”‚   â”‚   â”‚   â””â”€â”€ [name]/page.tsx    # æŸæ ‡ç­¾ä¸‹çš„æ–‡æ¡£åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ logs/page.tsx          # å®Œæ•´æ“ä½œæ—¥å¿—é¡µ
â”‚   â”‚   â””â”€â”€ settings/page.tsx      # ä¸ªäººè®¾ç½®é¡µ
â”‚   â””â”€â”€ api/                       # Route Handlersï¼ˆåç«¯ APIï¼‰
â”‚       â”œâ”€â”€ auth/                   # è®¤è¯ API
â”‚       â”‚   â””â”€â”€ [...nextauth]/route.ts
â”‚       â”œâ”€â”€ entries/
â”‚       â”‚   â”œâ”€â”€ route.ts           # POST åˆ›å»º / GET åˆ—è¡¨
â”‚       â”‚   â”œâ”€â”€ search/route.ts    # POST æ··åˆæ£€ç´¢
â”‚       â”‚   â””â”€â”€ [id]/
â”‚       â”‚       â”œâ”€â”€ route.ts       # GET/PUT/DELETE å•æ¡
â”‚       â”‚       â”œâ”€â”€ append/route.ts       # POST è¿½åŠ å†…å®¹
â”‚       â”‚       â”œâ”€â”€ sections/
â”‚       â”‚       â”‚   â”œâ”€â”€ route.ts          # GET section åˆ—è¡¨
â”‚       â”‚       â”‚   â””â”€â”€ [index]/route.ts  # GET/PUT å•ä¸ª section
â”‚       â”‚       â”œâ”€â”€ relations/route.ts    # GET/POST å…³è”
â”‚       â”‚       â”œâ”€â”€ relations/[relationId]/route.ts  # DELETE å…³è”
â”‚       â”‚       â”œâ”€â”€ related/route.ts      # GET æ¨èç›¸å…³æ–‡æ¡£
â”‚       â”‚       â””â”€â”€ versions/route.ts     # GET ç‰ˆæœ¬å†å²
â”‚       â”œâ”€â”€ notebooks/
â”‚       â”‚   â”œâ”€â”€ route.ts           # GET åˆ—è¡¨ / POST åˆ›å»º
â”‚       â”‚   â””â”€â”€ [id]/route.ts      # GET/PUT/DELETE å•ä¸ª
â”‚       â”œâ”€â”€ tags/
â”‚       â”‚   â””â”€â”€ route.ts           # GET æ ‡ç­¾åˆ—è¡¨
â”‚       â”œâ”€â”€ logs/
â”‚       â”‚   â””â”€â”€ route.ts           # GET æ“ä½œæ—¥å¿—
â”‚       â””â”€â”€ api-keys/
â”‚           â”œâ”€â”€ route.ts           # GET åˆ—è¡¨ / POST ç”Ÿæˆæ–°å¯†é’¥
â”‚           â””â”€â”€ [id]/route.ts      # PUT å¯ç”¨ç¦ç”¨ / DELETE åˆ é™¤å¯†é’¥
â”œâ”€â”€ lib/                           # å…±äº«ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ index.ts               # Prisma client å•ä¾‹
â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ entry.service.ts       # æ–‡æ¡£ CRUD + section æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ search.service.ts      # æ··åˆæ£€ç´¢é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ notebook.service.ts    # ç¬”è®°æœ¬ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tag.service.ts         # æ ‡ç­¾ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ relation.service.ts    # å…³è”ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ version.service.ts     # ç‰ˆæœ¬ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ log.service.ts         # Agent æ—¥å¿—
â”‚   â”‚   â””â”€â”€ api-key.service.ts    # API å¯†é’¥ç”Ÿæˆã€éªŒè¯ã€ç®¡ç†
â”‚   â”œâ”€â”€ embedding/
â”‚   â”‚   â””â”€â”€ index.ts               # embedding ç”Ÿæˆï¼ˆOpenAI API / æœ¬åœ°æ¨¡å‹ï¼‰
â”‚   â”œâ”€â”€ markdown/
â”‚   â”‚   â””â”€â”€ parser.ts              # MD è§£æã€section åˆ‡åˆ†ã€å­—æ•°ç»Ÿè®¡
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â””â”€â”€ hybrid.ts              # BM25 + å‘é‡ + RRF èåˆ
â”‚   â”œâ”€â”€ tasks/
â”‚   â”‚   â””â”€â”€ index.ts               # pg-boss ä»»åŠ¡é˜Ÿåˆ—ï¼ˆembedding æ›´æ–°ã€æ—¥å¿—æ¸…ç†ï¼‰
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ index.ts               # NextAuth é…ç½®
â”‚   â”‚   â””â”€â”€ api-key.ts             # API Key é‰´æƒä¸­é—´ä»¶ï¼ˆBearer token â†’ user_idï¼‰
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ index.ts               # å·¥å…·å‡½æ•°
â”œâ”€â”€ components/                    # React UI ç»„ä»¶
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx            # ä¾§è¾¹æ ï¼ˆç¬”è®°æœ¬ + æ ‡ç­¾å¯¼èˆªï¼‰
â”‚   â”‚   â”œâ”€â”€ topbar.tsx             # é¡¶éƒ¨æ ï¼ˆæœç´¢ + å¤´åƒï¼‰
â”‚   â”‚   â”œâ”€â”€ log-ticker.tsx         # åº•éƒ¨æ—¥å¿—æ»šåŠ¨æ¡
â”‚   â”‚   â””â”€â”€ user-menu.tsx          # ç”¨æˆ·å¤´åƒä¸‹æ‹‰èœå•
â”‚   â”œâ”€â”€ editor/
â”‚   â”‚   â””â”€â”€ markdown-editor.tsx    # Markdown ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ entries/
â”‚   â”‚   â”œâ”€â”€ entry-card.tsx         # æ–‡æ¡£åˆ—è¡¨å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ entry-detail.tsx       # æ–‡æ¡£è¯¦æƒ…å±•ç¤º
â”‚   â”‚   â”œâ”€â”€ entry-metadata.tsx     # å…ƒæ•°æ®åŒºï¼ˆæ ‡ç­¾ã€ç±»å‹ã€æ¥æºç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ entry-relations.tsx    # å…³è”æ–‡æ¡£åŒºåŸŸ
â”‚   â”‚   â””â”€â”€ version-history.tsx    # ç‰ˆæœ¬å†å²å¼¹çª—
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â”œâ”€â”€ search-bar.tsx         # å…¨å±€æœç´¢æ  + ä¸‹æ‹‰é¢„è§ˆ
â”‚   â”‚   â”œâ”€â”€ search-results.tsx     # æœç´¢ç»“æœåˆ—è¡¨
â”‚   â”‚   â””â”€â”€ search-filters.tsx     # ç­›é€‰é¢æ¿
â”‚   â”œâ”€â”€ notebooks/
â”‚   â”‚   â”œâ”€â”€ notebook-list.tsx      # ç¬”è®°æœ¬åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ notebook-form.tsx      # æ–°å»º/ç¼–è¾‘ç¬”è®°æœ¬è¡¨å•
â”‚   â”œâ”€â”€ tags/
â”‚   â”‚   â””â”€â”€ tag-badge.tsx          # æ ‡ç­¾å¾½ç« ç»„ä»¶
â”‚   â”œâ”€â”€ logs/
â”‚   â”‚   â”œâ”€â”€ log-ticker-item.tsx    # æ—¥å¿—æ»šåŠ¨æ¡å•æ¡
â”‚   â”‚   â””â”€â”€ log-list.tsx           # å®Œæ•´æ—¥å¿—åˆ—è¡¨
â”‚   â””â”€â”€ ui/                        # shadcn/ui åŸºç¡€ç»„ä»¶
â”‚       â””â”€â”€ ...                    # button, dialog, dropdown ç­‰
â”œâ”€â”€ mcp-server/                    # MCP Serverï¼ˆç‹¬ç«‹è¿›ç¨‹ï¼‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ index.ts                   # MCP åè®®å…¥å£ï¼ˆä»ç¯å¢ƒå˜é‡è¯» NOTEBRAIN_API_KEYï¼‰
â”‚   â”œâ”€â”€ tools/                     # å„ tool å®ç°
â”‚   â”‚   â”œâ”€â”€ entries.ts             # æ–‡æ¡£ç›¸å…³ tools
â”‚   â”‚   â”œâ”€â”€ notebooks.ts           # ç¬”è®°æœ¬ç›¸å…³ tools
â”‚   â”‚   â”œâ”€â”€ tags.ts                # æ ‡ç­¾ç›¸å…³ tools
â”‚   â”‚   â””â”€â”€ relations.ts          # å…³è”ç›¸å…³ tools
â”‚   â”œâ”€â”€ resources/                 # å„ resource å®ç°
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ client.ts                  # HTTP å®¢æˆ·ç«¯ï¼ˆæºå¸¦ API Key è°ƒ Next.js APIï¼‰
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma              # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ migrations/                # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ public/                        # é™æ€èµ„æº
â”‚   â””â”€â”€ logo.svg
â”œâ”€â”€ styles/
â”‚   â””â”€â”€ globals.css                # å…¨å±€æ ·å¼ + Tailwind æŒ‡ä»¤
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                   # å…±äº« TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ .env.example                   # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore
â”œâ”€â”€ next.config.ts
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ plan.md                        # æœ¬æ–‡ä»¶
```

---

## ä¹ã€å®ç°é˜¶æ®µ

### Phase 1ï¼šåŸºç¡€éª¨æ¶ï¼ˆMVPï¼‰

**ç›®æ ‡**ï¼šèƒ½é€šè¿‡ MCP å’Œå‰ç«¯è¿›è¡ŒåŸºæœ¬çš„æ–‡æ¡£ CRUDã€‚

- [x] é¡¹ç›®åˆå§‹åŒ–ï¼šNext.js + TypeScript + Tailwind + shadcn/ui
- [x] æ•°æ®åº“ï¼šPostgreSQL + Prisma schemaï¼ˆusers, notebooks, entries, tags, entry_tags, entry_versions, agent_logs, api_keysï¼‰
- [x] è®¤è¯ï¼šNextAuth.js åŸºç¡€ç™»å½•ï¼ˆé‚®ç®±+å¯†ç ï¼‰
- [x] MCP é‰´æƒï¼šAPI Key ç”Ÿæˆã€å­˜å‚¨ï¼ˆSHA-256 å“ˆå¸Œï¼‰ã€éªŒè¯ä¸­é—´ä»¶
- [x] API å±‚ï¼š
  - entries CRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ã€åˆ—è¡¨ï¼‰
  - notebooks CRUD
  - tags åˆ—è¡¨
  - agent_logs å†™å…¥å’Œè¯»å–
  - api-keys CRUDï¼ˆç”Ÿæˆã€åˆ—è¡¨ã€ç¦ç”¨/å¯ç”¨ã€åˆ é™¤ï¼‰
  - stats æ•°æ®ç»Ÿè®¡
  - chat AI å¯¹è¯ï¼ˆæµå¼ + Tool Callingï¼‰
  - chat/extract-url URL å†…å®¹æŠ“å–
- [x] å‰ç«¯ï¼š
  - æ•´ä½“å¸ƒå±€ï¼ˆä¾§è¾¹æ  + é¡¶æ  + åº•éƒ¨æ—¥å¿—æ¡ + ä¸»å†…å®¹åŒºï¼‰
  - é¡¶æ ï¼šLogo + æœç´¢æ ï¼ˆPhase 1 å…ˆåšç®€å•å…³é”®è¯æœç´¢ï¼‰+ å¤´åƒä¸‹æ‹‰èœå•
  - ä¾§è¾¹æ ï¼šç¬”è®°æœ¬åˆ—è¡¨ + æ ‡ç­¾åˆ—è¡¨ + AI åŠ©æ‰‹å…¥å£
  - æ–‡æ¡£åˆ—è¡¨é¡µï¼šå¡ç‰‡åˆ—è¡¨ + æ’åº + åˆ†é¡µ
  - æ–‡æ¡£è¯¦æƒ…é¡µï¼šMarkdown æ¸²æŸ“ + å…ƒæ•°æ®å±•ç¤º + å…³è”æ–‡æ¡£
  - æ–‡æ¡£ç¼–è¾‘é¡µï¼šMarkdown ç¼–è¾‘å™¨
  - Agent æ“ä½œæ—¥å¿—åº•éƒ¨æ»šåŠ¨æ¡ + å®Œæ•´æ—¥å¿—é¡µ
  - ä¸ªäººè®¾ç½®é¡µï¼šMCP API å¯†é’¥ç®¡ç† + æ•°æ®ç»Ÿè®¡
  - AI å¯¹è¯é¡µï¼šæµå¼é—®ç­” + Tool è°ƒç”¨å¯è§†åŒ–
  - æœç´¢ç»“æœé¡µ + æ ‡ç­¾ç­›é€‰é¡µ + ç¬”è®°æœ¬ç­›é€‰é¡µ
  - å®˜ç½‘é¦–é¡µï¼ˆLanding Pageï¼‰+ ç™»å½•æ³¨å†Œé¡µ
  - ä¸­é—´ä»¶è®¤è¯é‡å®šå‘
- [x] MCP Serverï¼š
  - åŸºç¡€æ¡†æ¶ + MCP åè®®å¯¹æ¥
  - Toolsï¼šentries_list, entry_get, entry_get_section, entry_create, entry_update, entry_append, entry_update_section, entry_replace, entry_delete
  - Toolsï¼šnotebooks_list, notebook_create, notebook_update, notebook_delete
  - Toolsï¼štags_list
  - Toolsï¼šentry_relations_list, entry_relation_create, entry_relation_delete
  - Toolsï¼šfetch_url
  - Resourcesï¼šnotebooks, tags, recent_entries
- [x] Markdown è§£æï¼šsection åˆ‡åˆ† + è¡Œå·åˆ†é¡µ + ç²¾ç¡®æ›¿æ¢
- [x] ç‰ˆæœ¬å†å²ï¼šæ¯æ¬¡ entry_update ä¿å­˜ç‰ˆæœ¬å¿«ç…§
- [x] Docker éƒ¨ç½²ï¼šdocker-compose + Dockerfile + å¤‡ä»½è„šæœ¬
- [x] AI æ¨¡å‹ï¼šæ”¯æŒä»»æ„ OpenAI å…¼å®¹ APIï¼ˆè‡ªå®šä¹‰ baseURL + modelï¼‰

### Phase 2ï¼šæ··åˆæ£€ç´¢

**ç›®æ ‡**ï¼šå®ç°"ä¸€å¥è¯æ‰¾åˆ°èµ„æ–™"çš„è¯­ä¹‰æœç´¢èƒ½åŠ›ã€‚

- [ ] pgvector æ‰©å±•å®‰è£…å’Œé…ç½®
- [ ] Embedding ç”Ÿæˆæ¨¡å—ï¼ˆOpenAI API / æœ¬åœ°æ¨¡å‹æ¥å…¥ï¼‰
- [ ] æ–‡æ¡£å†™å…¥æ—¶å¼‚æ­¥ç”Ÿæˆ embeddingï¼ˆpg-boss ä»»åŠ¡é˜Ÿåˆ—ï¼‰
  - æ‘˜è¦ embedding â†’ entries.summary_embedding
  - Section chunk embedding â†’ entry_chunks è¡¨
- [ ] å…¨æ–‡æ£€ç´¢ï¼šPG tsvector + ä¸­æ–‡åˆ†è¯ï¼ˆzhparser / pg_jiebaï¼‰
- [ ] æ··åˆæ£€ç´¢å®ç°ï¼šBM25 + å‘é‡ + RRF èåˆ
- [ ] APIï¼šentries/search æ¥å£
- [ ] MCP Toolï¼šentries_search
- [ ] å‰ç«¯ï¼š
  - æœç´¢æ å‡çº§ä¸ºè¯­ä¹‰æœç´¢
  - æœç´¢ä¸‹æ‹‰é¢„è§ˆ
  - æœç´¢ç»“æœé¡µï¼šå‘½ä¸­ç‰‡æ®µé«˜äº® + ç›¸å…³åº¦åˆ†æ•° + ç­›é€‰é¢æ¿
- [ ] é•¿æ–‡æ¡£æ”¯æŒï¼š
  - entry_get çš„ outline æ¨¡å¼
  - entry_get_section / entry_update_section
  - MCP Tools å¯¹åº”æ›´æ–°

### Phase 3ï¼šæ–‡æ¡£å…³è”

**ç›®æ ‡**ï¼šå®ç°æ–‡æ¡£ä¹‹é—´çš„æ˜¾å¼å…³è”å’Œæ™ºèƒ½æ¨èã€‚

- [ ] entry_relations è¡¨å’Œ API
- [ ] MCP Toolsï¼šentry_relations_list, entry_relation_create, entry_relation_delete, entry_find_related
- [ ] å‰ç«¯ï¼š
  - æ–‡æ¡£è¯¦æƒ…é¡µåº•éƒ¨"å…³è”æ–‡æ¡£"åŒºåŸŸ
  - [+ æ·»åŠ å…³è”] äº¤äº’ï¼ˆæœç´¢æ–‡æ¡£ + é€‰æ‹©å…³è”ç±»å‹ï¼‰
  - AI å»ºè®®å…³è”ï¼ˆåŸºäºå‘é‡ç›¸ä¼¼åº¦ï¼‰
  - å…³è”æ–‡æ¡£ç‚¹å‡»è·³è½¬
- [ ] MCP Resourceï¼šentry/{id}/context

### Phase 4ï¼šä½“éªŒä¼˜åŒ–

**ç›®æ ‡**ï¼šæ‰“ç£¨ç»†èŠ‚ï¼Œæå‡æ•´ä½“ä½¿ç”¨ä½“éªŒã€‚

- [ ] ç‰ˆæœ¬å†å² UIï¼šç‰ˆæœ¬åˆ—è¡¨ + diff å¯¹æ¯”è§†å›¾
- [ ] æ‰¹é‡æ“ä½œï¼šæ‰¹é‡æ‰“æ ‡ç­¾ã€ç§»åŠ¨ç¬”è®°æœ¬ã€åˆ é™¤
- [ ] æœç´¢å¿«æ·è¯­æ³•ï¼š`#æ ‡ç­¾å` `@ç¬”è®°æœ¬å`
- [ ] å…³è”å¯è§†åŒ–ï¼šä»¥å½“å‰æ–‡æ¡£ä¸ºä¸­å¿ƒçš„ä¸€è·³å…³ç³»å›¾ï¼ˆreact-flow / D3ï¼‰
- [ ] Agent æ“ä½œæ—¥å¿— 30 å¤©è‡ªåŠ¨æ¸…ç†ï¼ˆpg_cron æˆ–åº”ç”¨å±‚å®šæ—¶ä»»åŠ¡ï¼‰
- [ ] å¯¼å‡ºåŠŸèƒ½ï¼šå•ç¯‡å¯¼å‡º Markdownã€æ‰¹é‡å¯¼å‡º
- [ ] å“åº”å¼è®¾è®¡ï¼šç§»åŠ¨ç«¯é€‚é…
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼šæœç´¢ç»“æœç¼“å­˜ã€åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨

---

## åã€ç¯å¢ƒå˜é‡

```env
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/notebrain

# NextAuth
NEXTAUTH_SECRET=your-secret
NEXTAUTH_URL=http://localhost:3000

# OpenAI (ç”¨äº embedding)
OPENAI_API_KEY=sk-...
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# MCP Server
MCP_API_BASE_URL=http://localhost:3000/api
# æ³¨æ„ï¼šMCP_API_KEY ä¸å†æ˜¯å…¨å±€é…ç½®ï¼Œè€Œæ˜¯æ¯ä¸ªç”¨æˆ·åœ¨ã€Œä¸ªäººè®¾ç½®ã€ä¸­ç”Ÿæˆ
# MCP Client é…ç½®æ—¶å¡«å…¥ç”¨æˆ·è‡ªå·±çš„å¯†é’¥ï¼šNOTEBRAIN_API_KEY=nb_sk_xxx

# åº”ç”¨é…ç½®
LONG_DOC_THRESHOLD=2000
SEARCH_DEFAULT_LIMIT=5
EMBEDDING_DIMENSIONS=1536
```

---

## åä¸€ã€å…³é”®è®¾è®¡å†³ç­–è®°å½•

| å†³ç­– | é€‰æ‹© | åŸå›  |
|------|------|------|
| å…¨æ ˆæ¡†æ¶ | Next.js (ä¸ç”¨ NestJS) | ç®€åŒ–æ¶æ„ï¼Œä¸€ä¸ªé¡¹ç›®æå®šå‰åç«¯ |
| æ–‡æ¡£æ ¼å¼ | Markdown | Agent è¯»å†™å‹å¥½ï¼Œå‰ç«¯æ¸²æŸ“ç”Ÿæ€å¥½ |
| æ•°æ®åº“ | PG + pgvector (ä¸ç”¨ ES) | ä¸€åº“æå®šä¸šåŠ¡+å‘é‡+å…¨æ–‡ï¼Œè¿ç»´ç®€å• |
| çŸ¥è¯†å›¾è°± | è½»é‡å…³ç³»è¡¨ (ä¸ç”¨ Neo4j) | ç¬”è®°æœ¬+æ ‡ç­¾+å…³è”ä¸‰å±‚å¤Ÿç”¨ï¼Œä¸åšå®ä½“æŠ½å– |
| é•¿æ–‡æ¡£å¤„ç† | æŒ‰ heading åˆ‡åˆ† section | Agent å¯ä»¥æŒ‰æ®µæ“ä½œï¼ŒèŠ‚çœ token |
| ä¹è§‚é” | version å­—æ®µ | é˜²æ­¢ Agent å’Œç”¨æˆ·åŒæ—¶ä¿®æ”¹å†²çª |
| embedding æ›´æ–° | å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— | ä¸é˜»å¡å†™å…¥ï¼Œæ‰¹é‡å¯æ§ |
| æ“ä½œæ—¥å¿— | ä¿ç•™ 30 å¤© | å¹³è¡¡å­˜å‚¨å’Œå¯è¿½æº¯æ€§ |
| MCP Server | ç‹¬ç«‹è¿›ç¨‹ï¼Œè°ƒ Next.js API | èŒè´£åˆ†ç¦»ï¼ŒMCP åªåšåè®®é€‚é… |
| MCP é‰´æƒ | ç”¨æˆ·è‡ªç”Ÿæˆ API Keyï¼ˆSHA-256 å“ˆå¸Œå­˜å‚¨ï¼‰ | æ¯ç”¨æˆ·ç‹¬ç«‹å¯†é’¥ï¼Œæ”¯æŒå¤šè®¾å¤‡ï¼Œå¯éšæ—¶åŠé”€ |
