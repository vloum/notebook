# NoteBrain - äº§å“å®ç°è®¡åˆ’

> AI é©±åŠ¨çš„ä¸ªäººçŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œé€šè¿‡ MCP åè®®è®© Agent å¸®ä½ ç®¡ç†ã€æ£€ç´¢ã€æ›´æ–°ç¬”è®°æ–‡æ¡£ã€‚

---

## ä¸€ã€æ ¸å¿ƒéœ€æ±‚

1. **é€šè¿‡ MCP æ›´æ–°æ–‡æ¡£**ï¼šAgent èƒ½å®šä½åˆ°ä¸€ç¯‡å…·ä½“æ–‡æ¡£ï¼Œè¯»æ‡‚å†…å®¹ï¼Œåšå±€éƒ¨æˆ–æ•´ä½“ä¿®æ”¹ï¼Œå†™å›ä¿å­˜ã€‚
2. **ä¸€å¥è¯æ‰¾åˆ°èµ„æ–™**ï¼šAgent èƒ½åœ¨å¤§é‡æ–‡æ¡£ä¸­å¿«é€Ÿç¼©å°èŒƒå›´ï¼Œè¿”å›æœ€ç›¸å…³çš„å‡ ç¯‡ï¼Œå¹¶èƒ½ç»™å‡ºå‘½ä¸­ä¾æ®ã€‚

---

## äºŒã€æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| å‰ç«¯ | Next.js 15 (App Router) + React 19 + TypeScript | å…¨æ ˆæ¡†æ¶ï¼ŒSSR/SSG æ”¯æŒ |
| æ ·å¼ | Tailwind CSS 4 + shadcn/ui | ç°ä»£ UI ç»„ä»¶åº“ï¼Œå¯å®šåˆ¶æ€§å¼º |
| åç«¯ API | Next.js Route Handlers (`app/api/`) | å…¨æ ˆä¸€ä½“ï¼Œæ— éœ€ç‹¬ç«‹åç«¯ |
| æ•°æ®åº“ | PostgreSQL + pgvector æ‰©å±• | ä¸šåŠ¡æ•°æ® + å‘é‡ + å…¨æ–‡æ£€ç´¢ä¸€ä½“ |
| ORM | Prisma | ç±»å‹å®‰å…¨çš„æ•°æ®åº“è®¿é—® |
| è®¤è¯ | NextAuth.js (Auth.js v5) | æ”¯æŒå¤šç§ç™»å½•æ–¹å¼ |
| Markdown ç¼–è¾‘å™¨ | Milkdown æˆ– CodeMirror | æ‰€è§å³æ‰€å¾— / çº¯æ–‡æœ¬ç¼–è¾‘ |
| Markdown æ¸²æŸ“ | react-markdown + remark/rehype æ’ä»¶ | æ”¯æŒä»£ç é«˜äº®ã€è¡¨æ ¼ã€GFM |
| MCP Server | ç‹¬ç«‹ Node.js + TypeScript è¿›ç¨‹ | é€šè¿‡ HTTP è°ƒç”¨ Next.js API |
| Embedding æ¨¡å‹ | OpenAI text-embedding-3-smallï¼ˆæˆ–æœ¬åœ° bge-m3ï¼‰ | ä¸­æ–‡è¯­ä¹‰æ£€ç´¢ |
| ä¸­æ–‡åˆ†è¯ | pg_jieba æˆ– zhparser | PG å…¨æ–‡æ£€ç´¢ä¸­æ–‡æ”¯æŒ |
| å¼‚æ­¥ä»»åŠ¡ | pg-bossï¼ˆåŸºäº PG çš„ä»»åŠ¡é˜Ÿåˆ—ï¼‰ | embedding æ›´æ–°ã€æ—¥å¿—æ¸…ç†ç­‰ |

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 å®Œæ•´ ER å…³ç³»

```
users ||--o{ notebooks : owns
users ||--o{ entries : owns
notebooks ||--o{ entries : contains
entries ||--o{ entry_tags : has
tags ||--o{ entry_tags : used_in
entries ||--o{ entry_relations : from
entries ||--o{ entry_relations : to
entries ||--o{ entry_chunks : split_into
entries ||--o{ entry_versions : versioned
users ||--o{ agent_logs : has
```

### 3.2 è¡¨ç»“æ„

#### usersï¼ˆç”¨æˆ·è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| email | VARCHAR UNIQUE | é‚®ç®± |
| name | VARCHAR | æ˜¾ç¤ºåç§° |
| avatar_url | VARCHAR | å¤´åƒåœ°å€ |
| password_hash | VARCHAR | å¯†ç å“ˆå¸Œ |
| settings | JSONB | ç”¨æˆ·è®¾ç½®ï¼ˆä¸»é¢˜ã€è¯­è¨€ç­‰ï¼‰ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

#### notebooksï¼ˆç¬”è®°æœ¬è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| name | VARCHAR | ç¬”è®°æœ¬åç§° |
| description | TEXT | æè¿° |
| icon | VARCHAR | å›¾æ ‡ï¼ˆemoji æˆ–å›¾æ ‡åï¼‰ |
| sort_order | INTEGER | æ’åºæƒé‡ |
| is_default | BOOLEAN | æ˜¯å¦ä¸ºé»˜è®¤ç¬”è®°æœ¬ |
| is_archived | BOOLEAN | æ˜¯å¦å½’æ¡£ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

#### entriesï¼ˆæ–‡æ¡£/æ¡ç›®è¡¨ - æ ¸å¿ƒè¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| notebook_id | UUID FK â†’ notebooks | æ‰€å±ç¬”è®°æœ¬ |
| title | VARCHAR | æ–‡æ¡£æ ‡é¢˜ |
| content | TEXT | Markdown æ­£æ–‡ |
| summary | TEXT | æ‘˜è¦ï¼ˆè‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨ï¼‰ |
| type | ENUM('note','diary','experience','document') | æ–‡æ¡£ç±»å‹ |
| source | ENUM('manual','agent','import') | æ¥æº |
| word_count | INTEGER | å­—æ•° |
| version | INTEGER DEFAULT 1 | ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰ |
| summary_embedding | vector(1536) | æ ‡é¢˜+æ‘˜è¦çš„ embedding |
| search_vector | tsvector | å…¨æ–‡æ£€ç´¢åˆ†è¯å‘é‡ |
| metadata | JSONB | æ‰©å±•å…ƒæ•°æ® |
| is_pinned | BOOLEAN | æ˜¯å¦ç½®é¡¶ |
| is_archived | BOOLEAN | æ˜¯å¦å½’æ¡£ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

ç´¢å¼•ï¼š
- `USING hnsw (summary_embedding vector_cosine_ops)` â€” å‘é‡è¿‘ä¼¼æœç´¢
- `USING gin (search_vector)` â€” å…¨æ–‡æ£€ç´¢
- `USING gin (metadata)` â€” JSONB æŸ¥è¯¢
- `(user_id, notebook_id, updated_at DESC)` â€” åˆ—è¡¨æŸ¥è¯¢
- `(user_id, type, updated_at DESC)` â€” æŒ‰ç±»å‹ç­›é€‰

#### tagsï¼ˆæ ‡ç­¾è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| name | VARCHAR | æ ‡ç­¾å |
| color | VARCHAR | æ ‡ç­¾é¢œè‰²ï¼ˆå¯é€‰ï¼‰ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

å”¯ä¸€çº¦æŸï¼š`(user_id, name)`

#### entry_tagsï¼ˆæ–‡æ¡£-æ ‡ç­¾å…³è”è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| entry_id | UUID FK â†’ entries | æ–‡æ¡£ ID |
| tag_id | UUID FK â†’ tags | æ ‡ç­¾ ID |

å¤åˆä¸»é”®ï¼š`(entry_id, tag_id)`

#### entry_relationsï¼ˆæ–‡æ¡£å…³è”è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| from_id | UUID FK â†’ entries | æ¥æºæ–‡æ¡£ |
| to_id | UUID FK â†’ entries | ç›®æ ‡æ–‡æ¡£ |
| type | ENUM('references','continues','related','contradicts','summarizes') | å…³è”ç±»å‹ |
| metadata | JSONB | å…³è”çš„é¢å¤–ä¿¡æ¯ï¼ˆå¦‚å…³è”åŸå› ï¼‰ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

å”¯ä¸€çº¦æŸï¼š`(from_id, to_id, type)`

å…³è”ç±»å‹è¯´æ˜ï¼š
- `references` â€” A å¼•ç”¨ B
- `continues` â€” B æ˜¯ A çš„ç»­å†™
- `related` â€” ç›¸å…³ä¸»é¢˜
- `contradicts` â€” A ä¿®æ­£/æ¨ç¿»äº† B çš„ç»“è®º
- `summarizes` â€” A æ˜¯ B çš„æ€»ç»“

#### entry_chunksï¼ˆæ–‡æ¡£åˆ†æ®µè¡¨ - ç”¨äºé•¿æ–‡æ¡£å‘é‡æ£€ç´¢ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| entry_id | UUID FK â†’ entries (CASCADE) | æ‰€å±æ–‡æ¡£ |
| chunk_index | INTEGER | æ®µè½åºå· |
| heading | TEXT | section æ ‡é¢˜ï¼ˆå¦‚ "## è¸©å‘è®°å½•"ï¼‰ |
| content | TEXT | section æ­£æ–‡ |
| embedding | vector(1536) | è¯¥æ®µè½çš„å‘é‡ |
| token_count | INTEGER | token æ•°é‡ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

ç´¢å¼•ï¼š
- `USING hnsw (embedding vector_cosine_ops)` â€” æ®µè½çº§å‘é‡æœç´¢
- `(entry_id, chunk_index)` â€” æŒ‰æ–‡æ¡£å’Œé¡ºåºæŸ¥è¯¢

#### entry_versionsï¼ˆç‰ˆæœ¬å†å²è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| entry_id | UUID FK â†’ entries (CASCADE) | æ‰€å±æ–‡æ¡£ |
| version | INTEGER | ç‰ˆæœ¬å· |
| title | VARCHAR | è¯¥ç‰ˆæœ¬çš„æ ‡é¢˜ |
| content | TEXT | è¯¥ç‰ˆæœ¬çš„å®Œæ•´ Markdown å†…å®¹ |
| summary | TEXT | è¯¥ç‰ˆæœ¬çš„æ‘˜è¦ |
| change_summary | VARCHAR | å˜æ›´è¯´æ˜ï¼ˆå¦‚ "è¿½åŠ è¸©å‘è®°å½•"ï¼‰ |
| source | ENUM('manual','agent') | ä¿®æ”¹æ¥æº |
| word_count | INTEGER | å­—æ•° |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

ç´¢å¼•ï¼š`(entry_id, version DESC)`

#### agent_logsï¼ˆAgent æ“ä½œæ—¥å¿—è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID PK | ä¸»é”® |
| user_id | UUID FK â†’ users | æ‰€å±ç”¨æˆ· |
| action | VARCHAR(50) | æ“ä½œç±»å‹ï¼šcreate / update / delete / add_tag / add_relation / remove_tag / move |
| entry_id | UUID | æ“ä½œçš„æ–‡æ¡£ï¼ˆå¯ä¸ºç©ºï¼Œå¦‚åˆ›å»ºç¬”è®°æœ¬æ—¶ï¼‰ |
| entry_title | VARCHAR | æ–‡æ¡£æ ‡é¢˜ï¼ˆå†—ä½™å­˜å‚¨ï¼Œæ–¹ä¾¿æ—¥å¿—å±•ç¤ºï¼‰ |
| summary | TEXT | æ“ä½œæ‘˜è¦ï¼Œå¦‚ "è¿½åŠ äº†è¸©å‘è®°å½• section" |
| diff_stats | JSONB | å˜æ›´ç»Ÿè®¡ `{ added_words: 156, removed_words: 0 }` |
| metadata | JSONB | é¢å¤–ä¿¡æ¯ |
| created_at | TIMESTAMPTZ DEFAULT NOW() | æ“ä½œæ—¶é—´ |

ç´¢å¼•ï¼š`(user_id, created_at DESC)`

è‡ªåŠ¨æ¸…ç†ç­–ç•¥ï¼šä¿ç•™æœ€è¿‘ 30 å¤©çš„æ—¥å¿—
- ä½¿ç”¨ pg_cron æˆ–åº”ç”¨å±‚å®šæ—¶ä»»åŠ¡
- `DELETE FROM agent_logs WHERE created_at < NOW() - INTERVAL '30 days'`

---

## å››ã€æ··åˆæ£€ç´¢æ–¹æ¡ˆ

### 4.1 æ–‡æ¡£å‘é‡åŒ–æµç¨‹

æ–‡æ¡£å†™å…¥/æ›´æ–°æ—¶ï¼š
1. **ç”Ÿæˆæ‘˜è¦ embedding**ï¼ˆæ ‡é¢˜ + æ‘˜è¦ æ‹¼æ¥åç”Ÿæˆï¼‰â†’ å­˜å…¥ `entries.summary_embedding`ï¼Œç”¨äºæ–‡æ¡£çº§ç²—æ£€ç´¢
2. **æŒ‰ heading åˆ‡åˆ† sections** â†’ æ¯ä¸ª section ç”Ÿæˆ chunk embedding â†’ å­˜å…¥ `entry_chunks`ï¼Œç”¨äºæ®µè½çº§ç²¾æ£€ç´¢
3. **ç”Ÿæˆ tsvector**ï¼ˆä¸­æ–‡åˆ†è¯åå­˜å…¥ `entries.search_vector`ï¼‰â†’ ç”¨äºå…³é”®è¯ç²¾ç¡®åŒ¹é…
4. ä»¥ä¸Šæ­¥éª¤é€šè¿‡ **å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆpg-bossï¼‰** å¤„ç†ï¼Œä¸é˜»å¡å†™å…¥è¯·æ±‚

### 4.2 æœç´¢æµç¨‹

```
ç”¨æˆ· query â†’ ç”Ÿæˆ query embedding

ç¬¬ä¸€æ­¥ï¼šå…ƒæ•°æ®è¿‡æ»¤ï¼ˆnotebook_id, tags, date_range, typeï¼‰â†’ ç¼©å°å€™é€‰é›†
ç¬¬äºŒæ­¥ï¼šåŒè·¯å¬å›
  - BM25 è·¯ï¼štsvector @@ tsqueryï¼ŒæŒ‰ç›¸å…³åº¦æ‰“åˆ†
  - å‘é‡è·¯ï¼šembedding <=> query_embeddingï¼ŒæŒ‰ä½™å¼¦ç›¸ä¼¼åº¦æ‰“åˆ†
ç¬¬ä¸‰æ­¥ï¼šRRFï¼ˆReciprocal Rank Fusionï¼‰èåˆæ’åº
  - score = 1/(k + rank_bm25) + 1/(k + rank_vector)ï¼Œk é€šå¸¸å– 60
ç¬¬å››æ­¥ï¼šè¿”å› top-k æ–‡æ¡£ï¼Œé™„å¸¦å‘½ä¸­çš„ section ç‰‡æ®µï¼ˆé«˜äº®ï¼‰
```

### 4.3 Embedding æ›´æ–°ç­–ç•¥

- æ–‡æ¡£æ›´æ–°æ—¶åœ¨ entries è¡¨æ ‡è®° `embedding_stale = true`ï¼ˆæš‚ä¸åŠ æ­¤å­—æ®µï¼Œé€šè¿‡ä»»åŠ¡é˜Ÿåˆ—çŠ¶æ€ç®¡ç†ï¼‰
- å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—æ¶ˆè´¹æ›´æ–°äº‹ä»¶ï¼Œé‡æ–°è®¡ç®— embedding
- æ‰¹é‡å¯¼å…¥åœºæ™¯ï¼šé˜Ÿåˆ—é™æµï¼Œé¿å… API è°ƒç”¨è¿‡å¿«
- embedding æ¨¡å‹å­—æ®µé¢„ç•™ï¼š`entry_chunks` å¯åŠ  `model` å­—æ®µï¼Œæ–¹ä¾¿åç»­æ¢æ¨¡å‹

---

## äº”ã€é•¿æ–‡æ¡£å¤„ç†ç­–ç•¥

### 5.1 Section åˆ‡åˆ†è§„åˆ™

ä»¥ Markdown Headingï¼ˆ`#` / `##` / `###`ï¼‰ä¸ºè¾¹ç•Œåˆ‡åˆ† sectionsï¼š
- é¡¶çº§æ ‡é¢˜ï¼ˆ`#`ï¼‰ä½œä¸ºæ–‡æ¡£æ ‡é¢˜ï¼Œä¸å•ç‹¬æˆ section
- `##` çº§åˆ« heading ä½œä¸ºä¸»è¦ section åˆ†ç•Œ
- `###` åŠä»¥ä¸‹ heading å½’å±åˆ°æ‰€åœ¨çš„ `##` section ä¸­
- æ²¡æœ‰ä»»ä½• heading çš„å†…å®¹å½’å±åˆ° section 0ï¼ˆå¼€ç¯‡æ®µè½ï¼‰

### 5.2 çŸ­æ–‡æ¡£ vs é•¿æ–‡æ¡£

- **çŸ­æ–‡æ¡£ï¼ˆ< 2000 å­—ï¼‰**ï¼š`entry_get` ç›´æ¥è¿”å›å…¨æ–‡ï¼Œ`entry_update` æ•´ç¯‡å†™å›
- **é•¿æ–‡æ¡£ï¼ˆ>= 2000 å­—ï¼‰**ï¼š`entry_get` é»˜è®¤è¿”å›å¤§çº²æ¨¡å¼ï¼ˆæ ‡é¢˜ + section åˆ—è¡¨ + å­—æ•°ï¼‰ï¼Œéœ€è¦ç”¨ `entry_get_section` è¯»å–å…·ä½“æ®µè½ï¼Œç”¨ `entry_update_section` æ›´æ–°å…·ä½“æ®µè½
- é˜ˆå€¼ 2000 å­—å¯é…ç½®

### 5.3 Section æ›´æ–°åçš„å¤„ç†

1. æ›¿æ¢ç›®æ ‡ section å†…å®¹
2. æ‹¼å›å®Œæ•´æ–‡æ¡£
3. æ›´æ–° `entries.content` å’Œ `entries.word_count`
4. `version + 1`
5. ä¿å­˜ç‰ˆæœ¬å¿«ç…§åˆ° `entry_versions`
6. å¼‚æ­¥é‡æ–°è®¡ç®—è¯¥ section çš„ chunk embedding
7. å¼‚æ­¥æ›´æ–°æ–‡æ¡£çš„ summary_embeddingï¼ˆå¦‚æœæ‘˜è¦å˜äº†ï¼‰
8. å†™å…¥ `agent_logs`

---

## å…­ã€MCP Server è®¾è®¡

### 6.1 æ¶æ„å…³ç³»

```
MCP Client (Cursor/Claude ç­‰ Agent)
    â”‚
    â”‚ MCP åè®®ï¼ˆstdio / SSEï¼‰
    â–¼
MCP Serverï¼ˆç‹¬ç«‹ Node.js è¿›ç¨‹ï¼‰
    â”‚
    â”‚ HTTP è°ƒç”¨
    â–¼
Next.js API Routesï¼ˆ/api/*ï¼‰
    â”‚
    â”‚ Prisma ORM
    â–¼
PostgreSQL + pgvector
```

MCP Server åªåšåè®®é€‚é…å’Œ tool ç¼–æ’ï¼Œæ‰€æœ‰ä¸šåŠ¡é€»è¾‘é›†ä¸­åœ¨ Next.js API å±‚ã€‚

### 6.2 Tools æ¸…å•

#### æœç´¢ä¸å®šä½

**`entries_search`** â€” æ··åˆæ£€ç´¢æ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "query": "string (å¿…å¡«ï¼Œè‡ªç„¶è¯­è¨€æŸ¥è¯¢)",
  "filters": {
    "notebook_id": "string? (ç¬”è®°æœ¬ ID)",
    "tags": ["string[]? (æ ‡ç­¾åæ•°ç»„)"],
    "type": "note | diary | experience | document (å¯é€‰)",
    "date_from": "string? (ISO dateï¼Œå¦‚ 2026-01-01)",
    "date_to": "string? (ISO date)",
    "source": "manual | agent (å¯é€‰)"
  },
  "limit": "number? (é»˜è®¤ 5ï¼Œæœ€å¤§ 20)",
  "search_mode": "hybrid | semantic | keyword (é»˜è®¤ hybrid)"
}
```

è¿”å›ï¼š
```json
{
  "results": [
    {
      "id": "uuid",
      "title": "Redisç¼“å­˜ç­–ç•¥æ€»ç»“",
      "summary": "é¡¹ç›®ä¸­é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¼“å­˜ç­–ç•¥é€‰å‹ä¸è¸©å‘...",
      "tags": ["redis", "ç¼“å­˜", "æ¶æ„"],
      "notebook": { "id": "uuid", "name": "å·¥ä½œç¬”è®°" },
      "type": "experience",
      "source": "manual",
      "updated_at": "2026-02-01T10:00:00Z",
      "relevance_score": 0.87,
      "matched_section": "## è¸©å‘è®°å½•\nå†…å­˜æº¢å‡ºé—®é¢˜åœ¨é«˜å¹¶å‘ä¸‹...",
      "word_count": 3200
    }
  ],
  "total_count": 12
}
```

**`entries_list`** â€” çº¯å…ƒæ•°æ®åˆ—è¡¨ï¼ˆä¸èµ°å‘é‡ï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "notebook_id": "string?",
  "tags": ["string[]?"],
  "type": "string?",
  "sort_by": "updated_at | created_at | title (é»˜è®¤ updated_at)",
  "sort_order": "asc | desc (é»˜è®¤ desc)",
  "page": "number? (é»˜è®¤ 1)",
  "page_size": "number? (é»˜è®¤ 20)"
}
```

#### è¯»å–

**`entry_get`** â€” è·å–å•ç¯‡æ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "mode": "full | outline (å¯é€‰ï¼ŒçŸ­æ–‡æ¡£è‡ªåŠ¨ fullï¼Œé•¿æ–‡æ¡£è‡ªåŠ¨ outline)"
}
```

mode=full è¿”å›ï¼š
```json
{
  "id": "uuid",
  "title": "string",
  "content": "å®Œæ•´ markdown æ­£æ–‡",
  "summary": "æ‘˜è¦",
  "tags": ["string[]"],
  "notebook": { "id": "uuid", "name": "string" },
  "type": "string",
  "source": "string",
  "version": 5,
  "word_count": 800,
  "relations": [
    {
      "relation_id": "uuid",
      "target_id": "uuid",
      "target_title": "TTLç­–ç•¥ç¬”è®°",
      "type": "references",
      "direction": "outgoing"
    }
  ],
  "created_at": "ISO datetime",
  "updated_at": "ISO datetime"
}
```

mode=outline è¿”å›ï¼ˆé•¿æ–‡æ¡£ï¼‰ï¼š
```json
{
  "id": "uuid",
  "title": "string",
  "summary": "æ‘˜è¦",
  "tags": ["string[]"],
  "notebook": { "id": "uuid", "name": "string" },
  "type": "string",
  "source": "string",
  "version": 5,
  "word_count": 5200,
  "sections": [
    { "index": 0, "heading": "èƒŒæ™¯", "word_count": 120 },
    { "index": 1, "heading": "æ–¹æ¡ˆé€‰å‹", "word_count": 800 },
    { "index": 2, "heading": "è¸©å‘è®°å½•", "word_count": 500 },
    { "index": 3, "heading": "ç»“è®º", "word_count": 200 }
  ],
  "relations": [],
  "created_at": "ISO datetime",
  "updated_at": "ISO datetime"
}
```

**`entry_get_section`** â€” è·å–å•ä¸ª sectionï¼ˆé•¿æ–‡æ¡£ç”¨ï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "section_index": "number (å¿…å¡«ï¼Œsection åºå·)"
}
```

è¿”å›ï¼š
```json
{
  "heading": "è¸©å‘è®°å½•",
  "content": "## è¸©å‘è®°å½•\n1. å†…å­˜æº¢å‡ºé—®é¢˜...\n2. è¿‡æœŸé”®æ¸…ç†...",
  "word_count": 500,
  "chunk_id": "uuid"
}
```

#### å†™å…¥

**`entry_create`** â€” åˆ›å»ºæ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "title": "string (å¿…å¡«)",
  "content": "string (å¿…å¡«ï¼Œmarkdown æ­£æ–‡)",
  "notebook_id": "string? (ä¸ä¼ åˆ™æ”¾å…¥é»˜è®¤ç¬”è®°æœ¬)",
  "tags": ["string[]? (æ ‡ç­¾åæ•°ç»„ï¼Œä¸å­˜åœ¨çš„æ ‡ç­¾è‡ªåŠ¨åˆ›å»º)"],
  "type": "note | diary | experience | document (é»˜è®¤ note)",
  "summary": "string? (ä¸ä¼ åˆ™è‡ªåŠ¨ç”Ÿæˆ)",
  "metadata": "object? (æ‰©å±•å…ƒæ•°æ®)"
}
```

è¿”å›ï¼š
```json
{
  "id": "uuid",
  "title": "string",
  "version": 1,
  "created_at": "ISO datetime"
}
```

**`entry_update`** â€” æ›´æ–°æ–‡æ¡£ï¼ˆæ•´ç¯‡æˆ–å­—æ®µï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "title": "string?",
  "content": "string? (ä¼ åˆ™æ•´ç¯‡æ›¿æ¢)",
  "summary": "string?",
  "tags": ["string[]? (ä¼ åˆ™æ•´ä½“æ›¿æ¢æ ‡ç­¾)"],
  "notebook_id": "string?",
  "type": "string?",
  "version": "number (å¿…å¡«ï¼Œä¹è§‚é”)"
}
```

è¿”å›ï¼š
```json
{
  "id": "uuid",
  "version": 6,
  "updated_at": "ISO datetime"
}
```

**`entry_append`** â€” è¿½åŠ å†…å®¹åˆ°æ–‡æ¡£æœ«å°¾

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "content": "string (å¿…å¡«ï¼Œè¿½åŠ çš„ markdown å†…å®¹)",
  "version": "number (å¿…å¡«)"
}
```

**`entry_update_section`** â€” æ›´æ–°æ–‡æ¡£çš„æŸä¸ª section

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "section_index": "number (å¿…å¡«)",
  "content": "string (å¿…å¡«ï¼Œè¯¥ section çš„æ–°å†…å®¹)",
  "version": "number (å¿…å¡«)"
}
```

**`entry_delete`** â€” åˆ é™¤æ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)"
}
```

#### å…³è”

**`entry_relations_list`** â€” æŸ¥çœ‹æŸæ–‡æ¡£çš„æ‰€æœ‰å…³è”

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)"
}
```

è¿”å›ï¼š
```json
{
  "relations": [
    {
      "relation_id": "uuid",
      "target_id": "uuid",
      "target_title": "TTLç­–ç•¥ç¬”è®°",
      "target_summary": "å…³äº Redis TTL çš„...",
      "type": "references",
      "direction": "outgoing",
      "created_at": "ISO datetime"
    }
  ]
}
```

**`entry_relation_create`** â€” å»ºç«‹å…³è”

è¾“å…¥å‚æ•°ï¼š
```json
{
  "from_id": "string (å¿…å¡«)",
  "to_id": "string (å¿…å¡«)",
  "type": "references | continues | related | contradicts | summarizes (å¿…å¡«)"
}
```

**`entry_relation_delete`** â€” åˆ é™¤å…³è”

è¾“å…¥å‚æ•°ï¼š
```json
{
  "relation_id": "string (å¿…å¡«)"
}
```

**`entry_find_related`** â€” åŸºäºå‘é‡ç›¸ä¼¼åº¦æ¨èç›¸å…³æ–‡æ¡£

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "limit": "number? (é»˜è®¤ 5)"
}
```

è¿”å›ï¼šæ’é™¤å·²æœ‰æ˜¾å¼å…³è”çš„ã€è¯­ä¹‰æœ€ç›¸ä¼¼çš„ top-k æ–‡æ¡£åˆ—è¡¨ã€‚

#### ç¬”è®°æœ¬ç®¡ç†

**`notebooks_list`** â€” åˆ—å‡ºæ‰€æœ‰ç¬”è®°æœ¬

è¿”å›ï¼š
```json
{
  "notebooks": [
    {
      "id": "uuid",
      "name": "å·¥ä½œç¬”è®°",
      "description": "...",
      "icon": "ğŸ““",
      "entry_count": 23,
      "is_default": false,
      "created_at": "ISO datetime"
    }
  ]
}
```

**`notebook_create`** â€” åˆ›å»ºç¬”è®°æœ¬

è¾“å…¥å‚æ•°ï¼š
```json
{
  "name": "string (å¿…å¡«)",
  "description": "string?",
  "icon": "string? (emoji)"
}
```

**`notebook_update`** â€” æ›´æ–°ç¬”è®°æœ¬

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)",
  "name": "string?",
  "description": "string?",
  "icon": "string?"
}
```

**`notebook_delete`** â€” åˆ é™¤ç¬”è®°æœ¬ï¼ˆå…¶ä¸­çš„æ–‡æ¡£ç§»åˆ°é»˜è®¤ç¬”è®°æœ¬ï¼‰

è¾“å…¥å‚æ•°ï¼š
```json
{
  "id": "string (å¿…å¡«)"
}
```

#### æ ‡ç­¾ç®¡ç†

**`tags_list`** â€” åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾åŠä½¿ç”¨æ¬¡æ•°

è¿”å›ï¼š
```json
{
  "tags": [
    { "id": "uuid", "name": "redis", "color": "#e74c3c", "count": 12 },
    { "id": "uuid", "name": "æ¶æ„", "color": "#3498db", "count": 8 }
  ]
}
```

### 6.3 Resourcesï¼ˆåªè¯»ä¸Šä¸‹æ–‡ï¼‰

Agent å¯åŠ¨æ—¶å¯ä»¥å…ˆè¯»è¿™äº› resourceï¼Œäº†è§£ç”¨æˆ·çš„ç¬”è®°æœ¬ç»“æ„ï¼š

| URI | è¯´æ˜ |
|-----|------|
| `notebooks` | å½“å‰ç”¨æˆ·çš„ç¬”è®°æœ¬åˆ—è¡¨ï¼ˆåç§°ã€æ–‡æ¡£æ•°ï¼‰ |
| `tags` | å½“å‰ç”¨æˆ·çš„æ ‡ç­¾åˆ—è¡¨ï¼ˆåç§°ã€ä½¿ç”¨æ¬¡æ•°ï¼‰ |
| `recent_entries` | æœ€è¿‘æ›´æ–°çš„ 10 ç¯‡æ–‡æ¡£æ‘˜è¦ï¼ˆæ ‡é¢˜ + æ‘˜è¦ + æ ‡ç­¾ + æ›´æ–°æ—¶é—´ï¼‰ |
| `entry/{id}/context` | æŸç¯‡æ–‡æ¡£çš„æ‘˜è¦ + æ ‡ç­¾ + å…³è”åˆ—è¡¨ï¼ˆä¾¿äº Agent å†³ç­–ï¼‰ |

### 6.4 Agent æ“ä½œçš„å…¸å‹æµç¨‹

**åœºæ™¯ï¼šä¿®æ”¹æŸç¯‡æ–‡æ¡£çš„æŸä¸ªæ®µè½**
```
â‘  entries_search(query="è¶…æ—¶é‡è¯•", filters={date_from:"7å¤©å‰"})
   â†’ è¿”å› top-3 å€™é€‰
â‘¡ entry_get(id="å‘½ä¸­çš„é‚£ç¯‡", mode="outline")
   â†’ è¿”å›å¤§çº²ï¼šèƒŒæ™¯(120å­—) / æ–¹æ¡ˆ(800å­—) / è¸©å‘(500å­—) / ç»“è®º(200å­—)
â‘¢ entry_get_section(id, section_index=2)
   â†’ è¿”å› "è¸©å‘è®°å½•" å®Œæ•´å†…å®¹
â‘£ Agent ä¿®æ”¹å†…å®¹
â‘¤ entry_update_section(id, section_index=2, content="æ–°å†…å®¹", version=5)
   â†’ åç«¯ä¿å­˜ â†’ version å˜ä¸º 6 â†’ å¼‚æ­¥æ›´æ–° embedding â†’ å†™å…¥ agent_logs
```

**åœºæ™¯ï¼šåˆ›å»ºæ–°æ–‡æ¡£å¹¶å»ºç«‹å…³è”**
```
â‘  notebooks_list() â†’ äº†è§£æœ‰å“ªäº›ç¬”è®°æœ¬
â‘¡ entry_create(title="...", content="...", notebook_id="å·¥ä½œ", tags=["redis"])
   â†’ è¿”å› { id: "new-id" }
â‘¢ entries_search(query="ç›¸å…³ä¸»é¢˜") â†’ æ‰¾åˆ°å·²æœ‰æ–‡æ¡£
â‘£ entry_relation_create(from_id="new-id", to_id="related-id", type="continues")
```

---

## ä¸ƒã€å‰ç«¯é¡µé¢è®¾è®¡

### 7.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€[Logo]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ” æœç´¢æ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [é€šçŸ¥ğŸ””] [å¤´åƒğŸ‘¤]â”€â”
â”‚                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                                                         â”‚
â”‚ ä¾§è¾¹æ     â”‚              ä¸»å†…å®¹åŒº                                    â”‚
â”‚ (å¯æŠ˜å )  â”‚   (æ ¹æ®è·¯ç”±åˆ‡æ¢ï¼šæ–‡æ¡£åˆ—è¡¨ / æ–‡æ¡£è¯¦æƒ… / æœç´¢ç»“æœ)           â”‚
â”‚          â”‚                                                         â”‚
â”‚ ğŸ““ ç¬”è®°æœ¬  â”‚                                                         â”‚
â”‚  å…¨éƒ¨ç¬”è®°  â”‚                                                         â”‚
â”‚  â”œ å·¥ä½œ   â”‚                                                         â”‚
â”‚  â”œ å­¦ä¹    â”‚                                                         â”‚
â”‚  â”” é¡¹ç›®X  â”‚                                                         â”‚
â”‚  [+æ–°å»º]  â”‚                                                         â”‚
â”‚          â”‚                                                         â”‚
â”‚ ğŸ· æ ‡ç­¾    â”‚                                                         â”‚
â”‚  redis(5) â”‚                                                         â”‚
â”‚  æ¶æ„(3)  â”‚                                                         â”‚
â”‚  docker(2)â”‚                                                         â”‚
â”‚          â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ Agent æ“ä½œæ—¥å¿—æ»šåŠ¨æ¡                                 [æŸ¥çœ‹å…¨éƒ¨ â†’] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é¡¶éƒ¨å¯¼èˆªæ 

- **å·¦ä¾§**ï¼šLogo + äº§å“å "NoteBrain"
- **ä¸­é—´**ï¼šå…¨å±€æœç´¢æ ï¼Œå¸¸é©»
  - è¾“å…¥æ–‡å­—å 300ms é˜²æŠ–è§¦å‘æœç´¢
  - ä¸‹æ‹‰å±•ç¤ºæœç´¢ç»“æœé¢„è§ˆï¼ˆæœ€å¤š 5 æ¡ï¼šæ ‡é¢˜ + å‘½ä¸­ç‰‡æ®µï¼‰
  - å›è½¦è¿›å…¥å®Œæ•´æœç´¢ç»“æœé¡µ
  - æ”¯æŒå¿«æ·è¯­æ³•ï¼š`#redis` è‡ªåŠ¨è¯†åˆ«ä¸ºæ ‡ç­¾è¿‡æ»¤ï¼Œ`@å·¥ä½œ` è¯†åˆ«ä¸ºç¬”è®°æœ¬è¿‡æ»¤
- **å³ä¾§**ï¼š
  - ğŸ”” é€šçŸ¥é“ƒé“›ï¼šAgent æ“ä½œå®Œæˆçš„é€šçŸ¥
  - ğŸ‘¤ å¤´åƒï¼šç‚¹å‡»å±•å¼€ä¸‹æ‹‰èœå•
    - ç”¨æˆ·å + é‚®ç®±
    - ä¸ªäººè®¾ç½®ï¼ˆä¸»é¢˜åˆ‡æ¢ã€è¯­è¨€ã€API Key é…ç½®ï¼‰
    - æ•°æ®ç»Ÿè®¡ï¼ˆæ–‡æ¡£æ€»æ•°ã€æ ‡ç­¾æ•°ã€å­˜å‚¨ç”¨é‡ï¼‰
    - é€€å‡ºç™»å½•

### 7.3 ä¾§è¾¹æ 

- å¯æŠ˜å ï¼ˆç‚¹å‡» hamburger å›¾æ ‡ æˆ– å¿«æ·é”®ï¼‰
- **ç¬”è®°æœ¬åŒºåŸŸ**ï¼š
  - "å…¨éƒ¨ç¬”è®°" å…¥å£ï¼ˆæ˜¾ç¤ºæ‰€æœ‰æ–‡æ¡£åˆ—è¡¨ï¼‰
  - å„ç¬”è®°æœ¬åç§° + æ–‡æ¡£æ•°
  - å³é”®èœå•ï¼šé‡å‘½åã€å½’æ¡£ã€åˆ é™¤
  - åº•éƒ¨ [+ æ–°å»ºç¬”è®°æœ¬] æŒ‰é’®
- **æ ‡ç­¾åŒºåŸŸ**ï¼š
  - æ ‡ç­¾å + ä½¿ç”¨æ¬¡æ•°
  - ç‚¹å‡»æ ‡ç­¾ â†’ ä¸»å†…å®¹åŒºæ˜¾ç¤ºè¯¥æ ‡ç­¾ä¸‹çš„æ–‡æ¡£åˆ—è¡¨
  - æ ‡ç­¾å‰çš„è‰²ç‚¹è¡¨ç¤ºæ ‡ç­¾é¢œè‰²
- **æœ€è¿‘è®¿é—®**ï¼ˆå¯é€‰ï¼‰ï¼š
  - æœ€è¿‘æ‰“å¼€çš„ 5 ç¯‡æ–‡æ¡£å¿«æ·å…¥å£

### 7.4 æ–‡æ¡£åˆ—è¡¨é¡µ

é€‰ä¸­ç¬”è®°æœ¬æˆ–æ ‡ç­¾åæ˜¾ç¤ºï¼š

```
â”Œâ”€ å·¥ä½œç¬”è®° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [æ’åº: æœ€è¿‘æ›´æ–°â–¼] [+ æ–°å»º] â”€â”
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“„ Redisç¼“å­˜ç­–ç•¥æ€»ç»“                                      â”‚  â”‚
â”‚  â”‚ é¡¹ç›®ä¸­é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¼“å­˜ç­–ç•¥é€‰å‹ä¸è¸©å‘è®°å½•...                  â”‚  â”‚
â”‚  â”‚ ğŸ· redis  ç¼“å­˜  æ¶æ„    ğŸ“Š ç»éªŒ    ğŸ¤– AIæ›´æ–°äº2å°æ—¶å‰       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“„ Docker Compose éƒ¨ç½²æŒ‡å—                                â”‚  â”‚
â”‚  â”‚ ä½¿ç”¨ docker compose éƒ¨ç½²å¾®æœåŠ¡çš„å®Œæ•´æµç¨‹å’Œæ³¨æ„äº‹é¡¹...         â”‚  â”‚
â”‚  â”‚ ğŸ· docker  éƒ¨ç½²    ğŸ“Š æ–‡æ¡£    ğŸ¤– AIåˆ›å»ºäº3å°æ—¶å‰            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å…± 23 ç¯‡  [1] 2 3 â–¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

äº¤äº’ç»†èŠ‚ï¼š
- åˆ—è¡¨é¡¹ hover â†’ å³ä¾§æµ®ç°å¿«æ·æ“ä½œæŒ‰é’®ï¼ˆç¼–è¾‘ã€ç§»åŠ¨ã€åˆ é™¤ï¼‰
- æ¥æºæ ‡è®°ï¼šğŸ¤– AIæ›´æ–°äº... vs âœï¸ æ‰‹åŠ¨ç¼–è¾‘äº...
- ç‚¹å‡» â†’ è¿›å…¥æ–‡æ¡£è¯¦æƒ…é¡µ
- æ‰¹é‡æ“ä½œï¼šå·¦ä¾§ checkboxï¼Œé€‰ä¸­åé¡¶éƒ¨å‡ºç°æ‰¹é‡æ“ä½œæ ï¼ˆæ‰“æ ‡ç­¾ã€ç§»åŠ¨ç¬”è®°æœ¬ã€åˆ é™¤ï¼‰
- æ’åºé€‰é¡¹ï¼šæœ€è¿‘æ›´æ–°ã€æœ€è¿‘åˆ›å»ºã€æ ‡é¢˜å­—æ¯åº
- [+ æ–°å»º] æŒ‰é’® â†’ åˆ›å»ºæ–°æ–‡æ¡£ï¼ˆè¿›å…¥ç¼–è¾‘å™¨é¡µé¢ï¼Œè‡ªåŠ¨å½’å…¥å½“å‰ç¬”è®°æœ¬ï¼‰

### 7.5 æ–‡æ¡£è¯¦æƒ…é¡µï¼ˆæ ¸å¿ƒé¡µé¢ï¼‰

```
â”Œâ”€ [â† è¿”å›åˆ—è¡¨]  å·¥ä½œç¬”è®° / Redisç¼“å­˜ç­–ç•¥æ€»ç»“ â”€â”€â”€ [ç¼–è¾‘âœï¸] [Â·Â·Â·] â”€â”
â”‚                                                                   â”‚
â”‚  â”Œâ”€ å…ƒæ•°æ®åŒº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ· redis  ç¼“å­˜  æ¶æ„  [+ æ·»åŠ æ ‡ç­¾]                           â”‚  â”‚
â”‚  â”‚ ğŸ“Š ç±»å‹: ç»éªŒ  â”‚  ğŸ““ ç¬”è®°æœ¬: å·¥ä½œ  â”‚  ğŸ“… æ›´æ–°: 2026-02-08   â”‚  â”‚
â”‚  â”‚ ğŸ¤– æœ€åç”± AI æ›´æ–°äº 2 å°æ—¶å‰  â”‚  ç‰ˆæœ¬ #5  [æŸ¥çœ‹å†å²]          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ æ­£æ–‡åŒºï¼ˆMarkdown æ¸²æŸ“ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  # Redisç¼“å­˜ç­–ç•¥æ€»ç»“                                         â”‚  â”‚
â”‚  â”‚  ## èƒŒæ™¯                                                     â”‚  â”‚
â”‚  â”‚  é¡¹ç›®ä¸­é‡åˆ°äº†é«˜å¹¶å‘è¯»å–çš„é—®é¢˜...                               â”‚  â”‚
â”‚  â”‚  ## æ–¹æ¡ˆé€‰å‹                                                  â”‚  â”‚
â”‚  â”‚  ...                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ å…³è”æ–‡æ¡£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [+ æ·»åŠ å…³è”] â”€â”  â”‚
â”‚  â”‚  å¼•ç”¨ â†’   ğŸ“„ TTLè¿‡æœŸç­–ç•¥ç¬”è®°                                  â”‚  â”‚
â”‚  â”‚  è¢«å¼•ç”¨ â† ğŸ“„ ç”µå•†ç³»ç»Ÿæ¶æ„è®¾è®¡                                  â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  ğŸ’¡ AI å»ºè®®å…³è”ï¼š                                             â”‚  â”‚
â”‚  â”‚     ğŸ“„ Memcached vs Rediså¯¹æ¯” (ç›¸ä¼¼åº¦ 89%)    [å»ºç«‹å…³è”] [å¿½ç•¥]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å³ä¸Šè§’ `[Â·Â·Â·]` ä¸‹æ‹‰èœå•ï¼š
- ç§»åŠ¨åˆ°å…¶ä»–ç¬”è®°æœ¬
- å¯¼å‡ºä¸º Markdown æ–‡ä»¶
- å¤åˆ¶åˆ†äº«é“¾æ¥
- æŸ¥çœ‹ç‰ˆæœ¬å†å²
- åˆ é™¤æ–‡æ¡£

ç¼–è¾‘æ¨¡å¼ï¼š
- ç‚¹å‡» [ç¼–è¾‘] â†’ æ­£æ–‡åŒºåˆ‡æ¢ä¸º Markdown ç¼–è¾‘å™¨ï¼ˆMilkdown æ‰€è§å³æ‰€å¾—ï¼‰
- è‡ªåŠ¨ä¿å­˜ï¼ˆdebounce 2 ç§’ï¼‰+ æ‰‹åŠ¨ä¿å­˜æŒ‰é’®
- ä¿å­˜æ—¶ version + 1ï¼Œåç«¯å¼‚æ­¥æ›´æ–° embedding
- ç¼–è¾‘å™¨å·¥å…·æ ï¼šç²—ä½“ã€æ–œä½“ã€æ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç å—ã€é“¾æ¥ã€å›¾ç‰‡

ç‰ˆæœ¬å†å²å¼¹çª—ï¼š
- ç‰ˆæœ¬åˆ—è¡¨ï¼šç‰ˆæœ¬å· + æ—¶é—´ + æ¥æºï¼ˆAI/æ‰‹åŠ¨ï¼‰+ å˜æ›´è¯´æ˜
- [æ¢å¤] æŒ‰é’®ï¼šæ¢å¤åˆ°è¯¥ç‰ˆæœ¬
- [å¯¹æ¯”] æŒ‰é’®ï¼šæ‰“å¼€ diff è§†å›¾ï¼Œå·¦å³å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬

### 7.6 æœç´¢ç»“æœé¡µ

```
â”Œâ”€ æœç´¢ç»“æœï¼š"æ¥å£è¶…æ—¶é‡è¯•" â”€â”€â”€â”€â”€â”€â”€ å…± 8 æ¡ç»“æœ â”€â”€â”€â”€ [ç­›é€‰é¢æ¿â–¼] â”€â”
â”‚                                                                â”‚
â”‚  â”Œâ”€ ç­›é€‰æ¡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç¬”è®°æœ¬: [å…¨éƒ¨â–¼]  æ ‡ç­¾: [é€‰æ‹©â–¼]  ç±»å‹: [å…¨éƒ¨â–¼]  æ—¶é—´: [ä¸é™â–¼]â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“„ HTTPè¯·æ±‚å¤±è´¥å¤„ç†æ–¹æ¡ˆ                     ç›¸å…³åº¦: 92%     â”‚â”‚
â”‚  â”‚ "...é‡‡ç”¨ exponential backoff ç­–ç•¥è¿›è¡Œé‡è¯•ï¼Œ                 â”‚â”‚
â”‚  â”‚  å½“è¿ç»­è¶…æ—¶3æ¬¡åè§¦å‘ç†”æ–­æœºåˆ¶..."                              â”‚â”‚
â”‚  â”‚ ğŸ· http  å¼‚å¸¸å¤„ç†    ğŸ““ å·¥ä½œ    ğŸ“… 2026-02-05              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â”‚  ...æ›´å¤šç»“æœ...                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

äº¤äº’ç»†èŠ‚ï¼š
- å‘½ä¸­ç‰‡æ®µä¸­å…³é”®è¯åŠ ç²—é«˜äº®
- æ˜¾ç¤ºç›¸å…³åº¦åˆ†æ•°
- ç­›é€‰é¢æ¿å¯å±•å¼€/æŠ˜å 
- ç‚¹å‡»ç»“æœ â†’ è¿›å…¥æ–‡æ¡£è¯¦æƒ…é¡µï¼Œè‡ªåŠ¨å®šä½åˆ°å‘½ä¸­çš„ section

### 7.7 Agent æ“ä½œæ—¥å¿—

**åº•éƒ¨æ»šåŠ¨æ¡ï¼ˆé»˜è®¤çŠ¶æ€ï¼‰**ï¼š
- å›ºå®šåœ¨é¡µé¢åº•éƒ¨ï¼Œé«˜åº¦çº¦ 40px
- æ—¥å¿—æ¡ç›®ä»ä¸‹å¾€ä¸Šæ»šåŠ¨ï¼ˆåƒå¹¿å‘Šç¿»ç‰Œï¼‰ï¼Œæ¯æ¡åœç•™ 3 ç§’
- æ¯æ¡æ ¼å¼ï¼š`[æ—¶é—´] AI åŠ¨ä½œæè¿° - æ–‡æ¡£åç§°`
- åŠ¨ä½œç±»å‹é¢œè‰²æ ‡è®°ï¼š
  - ğŸŸ¢ åˆ›å»ºï¼ˆç»¿è‰²ï¼‰
  - ğŸ”µ æ›´æ–°ï¼ˆè“è‰²ï¼‰
  - ğŸŸ¡ æ·»åŠ æ ‡ç­¾/å…³è”ï¼ˆé»„è‰²ï¼‰
  - ğŸ”´ åˆ é™¤ï¼ˆçº¢è‰²ï¼‰
- é¼ æ ‡ hover æ—¶æš‚åœæ»šåŠ¨
- ç‚¹å‡»æŸæ¡æ—¥å¿— â†’ è·³è½¬åˆ°å¯¹åº”æ–‡æ¡£
- å³ä¾§ [æŸ¥çœ‹å…¨éƒ¨ â†’] æŒ‰é’®

**å®Œæ•´æ—¥å¿—é¡µé¢/æŠ½å±‰**ï¼ˆç‚¹å‡» [æŸ¥çœ‹å…¨éƒ¨] åï¼‰ï¼š
- æŒ‰æ—¥æœŸåˆ†ç»„ï¼šä»Šå¤©ã€æ˜¨å¤©ã€æ›´æ—©...
- æ¯æ¡æ—¥å¿—æ˜¾ç¤ºï¼š
  - åŠ¨ä½œå›¾æ ‡ + é¢œè‰²
  - æ—¶é—´
  - æ“ä½œæè¿°
  - å˜æ›´ç»Ÿè®¡ï¼ˆå¦‚ +156 å­—ï¼‰
  - [æŸ¥çœ‹æ–‡æ¡£] [å¯¹æ¯”] æ“ä½œæŒ‰é’®
- æ”¯æŒç­›é€‰ï¼šæŒ‰åŠ¨ä½œç±»å‹ã€æŒ‰æ–‡æ¡£
- åº•éƒ¨æç¤ºï¼šæ—¥å¿—ä¿ç•™ 30 å¤©ï¼Œæ›´æ—©çš„å·²è‡ªåŠ¨æ¸…ç†

---

## å…«ã€é¡¹ç›®ç›®å½•ç»“æ„

```
notebrain/
â”œâ”€â”€ app/                           # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                    # è®¤è¯ç›¸å…³é¡µé¢ï¼ˆç™»å½•/æ³¨å†Œï¼‰
â”‚   â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”‚   â””â”€â”€ register/page.tsx
â”‚   â”œâ”€â”€ (main)/                    # ç™»å½•åçš„ä¸»å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ layout.tsx             # ä¾§è¾¹æ  + é¡¶æ  + åº•éƒ¨æ—¥å¿—æ¡ çš„å£³
â”‚   â”‚   â”œâ”€â”€ page.tsx               # é¦–é¡µï¼ˆæœ€è¿‘æ–‡æ¡£ / ä»ªè¡¨ç›˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ notebooks/
â”‚   â”‚   â”‚   â””â”€â”€ [id]/page.tsx      # æŸç¬”è®°æœ¬çš„æ–‡æ¡£åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ entries/
â”‚   â”‚   â”‚   â”œâ”€â”€ new/page.tsx       # æ–°å»ºæ–‡æ¡£
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx       # æ–‡æ¡£è¯¦æƒ…ï¼ˆé˜…è¯»æ¨¡å¼ï¼‰
â”‚   â”‚   â”‚       â””â”€â”€ edit/page.tsx  # æ–‡æ¡£ç¼–è¾‘
â”‚   â”‚   â”œâ”€â”€ search/page.tsx        # æœç´¢ç»“æœé¡µ
â”‚   â”‚   â”œâ”€â”€ tags/
â”‚   â”‚   â”‚   â””â”€â”€ [name]/page.tsx    # æŸæ ‡ç­¾ä¸‹çš„æ–‡æ¡£åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ logs/page.tsx          # å®Œæ•´æ“ä½œæ—¥å¿—é¡µ
â”‚   â”‚   â””â”€â”€ settings/page.tsx      # ä¸ªäººè®¾ç½®é¡µ
â”‚   â””â”€â”€ api/                       # Route Handlersï¼ˆåç«¯ APIï¼‰
â”‚       â”œâ”€â”€ auth/                   # è®¤è¯ API
â”‚       â”‚   â””â”€â”€ [...nextauth]/route.ts
â”‚       â”œâ”€â”€ entries/
â”‚       â”‚   â”œâ”€â”€ route.ts           # POST åˆ›å»º / GET åˆ—è¡¨
â”‚       â”‚   â”œâ”€â”€ search/route.ts    # POST æ··åˆæ£€ç´¢
â”‚       â”‚   â””â”€â”€ [id]/
â”‚       â”‚       â”œâ”€â”€ route.ts       # GET/PUT/DELETE å•æ¡
â”‚       â”‚       â”œâ”€â”€ append/route.ts       # POST è¿½åŠ å†…å®¹
â”‚       â”‚       â”œâ”€â”€ sections/
â”‚       â”‚       â”‚   â”œâ”€â”€ route.ts          # GET section åˆ—è¡¨
â”‚       â”‚       â”‚   â””â”€â”€ [index]/route.ts  # GET/PUT å•ä¸ª section
â”‚       â”‚       â”œâ”€â”€ relations/route.ts    # GET/POST å…³è”
â”‚       â”‚       â”œâ”€â”€ relations/[relationId]/route.ts  # DELETE å…³è”
â”‚       â”‚       â”œâ”€â”€ related/route.ts      # GET æ¨èç›¸å…³æ–‡æ¡£
â”‚       â”‚       â””â”€â”€ versions/route.ts     # GET ç‰ˆæœ¬å†å²
â”‚       â”œâ”€â”€ notebooks/
â”‚       â”‚   â”œâ”€â”€ route.ts           # GET åˆ—è¡¨ / POST åˆ›å»º
â”‚       â”‚   â””â”€â”€ [id]/route.ts      # GET/PUT/DELETE å•ä¸ª
â”‚       â”œâ”€â”€ tags/
â”‚       â”‚   â””â”€â”€ route.ts           # GET æ ‡ç­¾åˆ—è¡¨
â”‚       â””â”€â”€ logs/
â”‚           â””â”€â”€ route.ts           # GET æ“ä½œæ—¥å¿—
â”œâ”€â”€ lib/                           # å…±äº«ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ index.ts               # Prisma client å•ä¾‹
â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ entry.service.ts       # æ–‡æ¡£ CRUD + section æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ search.service.ts      # æ··åˆæ£€ç´¢é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ notebook.service.ts    # ç¬”è®°æœ¬ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tag.service.ts         # æ ‡ç­¾ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ relation.service.ts    # å…³è”ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ version.service.ts     # ç‰ˆæœ¬ç®¡ç†
â”‚   â”‚   â””â”€â”€ log.service.ts         # Agent æ—¥å¿—
â”‚   â”œâ”€â”€ embedding/
â”‚   â”‚   â””â”€â”€ index.ts               # embedding ç”Ÿæˆï¼ˆOpenAI API / æœ¬åœ°æ¨¡å‹ï¼‰
â”‚   â”œâ”€â”€ markdown/
â”‚   â”‚   â””â”€â”€ parser.ts              # MD è§£æã€section åˆ‡åˆ†ã€å­—æ•°ç»Ÿè®¡
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â””â”€â”€ hybrid.ts              # BM25 + å‘é‡ + RRF èåˆ
â”‚   â”œâ”€â”€ tasks/
â”‚   â”‚   â””â”€â”€ index.ts               # pg-boss ä»»åŠ¡é˜Ÿåˆ—ï¼ˆembedding æ›´æ–°ã€æ—¥å¿—æ¸…ç†ï¼‰
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ index.ts               # NextAuth é…ç½®
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ index.ts               # å·¥å…·å‡½æ•°
â”œâ”€â”€ components/                    # React UI ç»„ä»¶
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx            # ä¾§è¾¹æ ï¼ˆç¬”è®°æœ¬ + æ ‡ç­¾å¯¼èˆªï¼‰
â”‚   â”‚   â”œâ”€â”€ topbar.tsx             # é¡¶éƒ¨æ ï¼ˆæœç´¢ + å¤´åƒï¼‰
â”‚   â”‚   â”œâ”€â”€ log-ticker.tsx         # åº•éƒ¨æ—¥å¿—æ»šåŠ¨æ¡
â”‚   â”‚   â””â”€â”€ user-menu.tsx          # ç”¨æˆ·å¤´åƒä¸‹æ‹‰èœå•
â”‚   â”œâ”€â”€ editor/
â”‚   â”‚   â””â”€â”€ markdown-editor.tsx    # Markdown ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ entries/
â”‚   â”‚   â”œâ”€â”€ entry-card.tsx         # æ–‡æ¡£åˆ—è¡¨å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ entry-detail.tsx       # æ–‡æ¡£è¯¦æƒ…å±•ç¤º
â”‚   â”‚   â”œâ”€â”€ entry-metadata.tsx     # å…ƒæ•°æ®åŒºï¼ˆæ ‡ç­¾ã€ç±»å‹ã€æ¥æºç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ entry-relations.tsx    # å…³è”æ–‡æ¡£åŒºåŸŸ
â”‚   â”‚   â””â”€â”€ version-history.tsx    # ç‰ˆæœ¬å†å²å¼¹çª—
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â”œâ”€â”€ search-bar.tsx         # å…¨å±€æœç´¢æ  + ä¸‹æ‹‰é¢„è§ˆ
â”‚   â”‚   â”œâ”€â”€ search-results.tsx     # æœç´¢ç»“æœåˆ—è¡¨
â”‚   â”‚   â””â”€â”€ search-filters.tsx     # ç­›é€‰é¢æ¿
â”‚   â”œâ”€â”€ notebooks/
â”‚   â”‚   â”œâ”€â”€ notebook-list.tsx      # ç¬”è®°æœ¬åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ notebook-form.tsx      # æ–°å»º/ç¼–è¾‘ç¬”è®°æœ¬è¡¨å•
â”‚   â”œâ”€â”€ tags/
â”‚   â”‚   â””â”€â”€ tag-badge.tsx          # æ ‡ç­¾å¾½ç« ç»„ä»¶
â”‚   â”œâ”€â”€ logs/
â”‚   â”‚   â”œâ”€â”€ log-ticker-item.tsx    # æ—¥å¿—æ»šåŠ¨æ¡å•æ¡
â”‚   â”‚   â””â”€â”€ log-list.tsx           # å®Œæ•´æ—¥å¿—åˆ—è¡¨
â”‚   â””â”€â”€ ui/                        # shadcn/ui åŸºç¡€ç»„ä»¶
â”‚       â””â”€â”€ ...                    # button, dialog, dropdown ç­‰
â”œâ”€â”€ mcp-server/                    # MCP Serverï¼ˆç‹¬ç«‹è¿›ç¨‹ï¼‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ index.ts                   # MCP åè®®å…¥å£
â”‚   â”œâ”€â”€ tools/                     # å„ tool å®ç°
â”‚   â”‚   â”œâ”€â”€ entries.ts             # æ–‡æ¡£ç›¸å…³ tools
â”‚   â”‚   â”œâ”€â”€ notebooks.ts           # ç¬”è®°æœ¬ç›¸å…³ tools
â”‚   â”‚   â”œâ”€â”€ tags.ts                # æ ‡ç­¾ç›¸å…³ tools
â”‚   â”‚   â””â”€â”€ relations.ts          # å…³è”ç›¸å…³ tools
â”‚   â”œâ”€â”€ resources/                 # å„ resource å®ç°
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ client.ts                  # HTTP å®¢æˆ·ç«¯ï¼ˆè°ƒ Next.js APIï¼‰
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma              # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ migrations/                # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ public/                        # é™æ€èµ„æº
â”‚   â””â”€â”€ logo.svg
â”œâ”€â”€ styles/
â”‚   â””â”€â”€ globals.css                # å…¨å±€æ ·å¼ + Tailwind æŒ‡ä»¤
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                   # å…±äº« TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ .env.example                   # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore
â”œâ”€â”€ next.config.ts
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ plan.md                        # æœ¬æ–‡ä»¶
```

---

## ä¹ã€å®ç°é˜¶æ®µ

### Phase 1ï¼šåŸºç¡€éª¨æ¶ï¼ˆMVPï¼‰

**ç›®æ ‡**ï¼šèƒ½é€šè¿‡ MCP å’Œå‰ç«¯è¿›è¡ŒåŸºæœ¬çš„æ–‡æ¡£ CRUDã€‚

- [ ] é¡¹ç›®åˆå§‹åŒ–ï¼šNext.js + TypeScript + Tailwind + shadcn/ui
- [ ] æ•°æ®åº“ï¼šPostgreSQL + Prisma schemaï¼ˆusers, notebooks, entries, tags, entry_tags, entry_versions, agent_logsï¼‰
- [ ] è®¤è¯ï¼šNextAuth.js åŸºç¡€ç™»å½•ï¼ˆé‚®ç®±+å¯†ç  æˆ– GitHub OAuthï¼‰
- [ ] API å±‚ï¼š
  - entries CRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ã€åˆ—è¡¨ï¼‰
  - notebooks CRUD
  - tags åˆ—è¡¨
  - agent_logs å†™å…¥å’Œè¯»å–
- [ ] å‰ç«¯ï¼š
  - æ•´ä½“å¸ƒå±€ï¼ˆä¾§è¾¹æ  + é¡¶æ  + åº•éƒ¨æ—¥å¿—æ¡ + ä¸»å†…å®¹åŒºï¼‰
  - é¡¶æ ï¼šLogo + æœç´¢æ ï¼ˆPhase 1 å…ˆåšç®€å•å…³é”®è¯æœç´¢ï¼‰+ å¤´åƒä¸‹æ‹‰èœå•
  - ä¾§è¾¹æ ï¼šç¬”è®°æœ¬åˆ—è¡¨ + æ ‡ç­¾åˆ—è¡¨
  - æ–‡æ¡£åˆ—è¡¨é¡µï¼šå¡ç‰‡åˆ—è¡¨ + æ’åº + åˆ†é¡µ
  - æ–‡æ¡£è¯¦æƒ…é¡µï¼šMarkdown æ¸²æŸ“ + å…ƒæ•°æ®å±•ç¤º
  - æ–‡æ¡£ç¼–è¾‘é¡µï¼šMarkdown ç¼–è¾‘å™¨
  - Agent æ“ä½œæ—¥å¿—åº•éƒ¨æ»šåŠ¨æ¡ + å®Œæ•´æ—¥å¿—é¡µ
- [ ] MCP Serverï¼š
  - åŸºç¡€æ¡†æ¶ + MCP åè®®å¯¹æ¥
  - Toolsï¼šentries_list, entry_get, entry_create, entry_update, entry_append, entry_delete
  - Toolsï¼šnotebooks_list, notebook_create
  - Toolsï¼štags_list
  - Resourcesï¼šnotebooks, tags, recent_entries
- [ ] Markdown è§£æï¼šsection åˆ‡åˆ†é€»è¾‘
- [ ] ç‰ˆæœ¬å†å²ï¼šæ¯æ¬¡ entry_update ä¿å­˜ç‰ˆæœ¬å¿«ç…§

### Phase 2ï¼šæ··åˆæ£€ç´¢

**ç›®æ ‡**ï¼šå®ç°"ä¸€å¥è¯æ‰¾åˆ°èµ„æ–™"çš„è¯­ä¹‰æœç´¢èƒ½åŠ›ã€‚

- [ ] pgvector æ‰©å±•å®‰è£…å’Œé…ç½®
- [ ] Embedding ç”Ÿæˆæ¨¡å—ï¼ˆOpenAI API / æœ¬åœ°æ¨¡å‹æ¥å…¥ï¼‰
- [ ] æ–‡æ¡£å†™å…¥æ—¶å¼‚æ­¥ç”Ÿæˆ embeddingï¼ˆpg-boss ä»»åŠ¡é˜Ÿåˆ—ï¼‰
  - æ‘˜è¦ embedding â†’ entries.summary_embedding
  - Section chunk embedding â†’ entry_chunks è¡¨
- [ ] å…¨æ–‡æ£€ç´¢ï¼šPG tsvector + ä¸­æ–‡åˆ†è¯ï¼ˆzhparser / pg_jiebaï¼‰
- [ ] æ··åˆæ£€ç´¢å®ç°ï¼šBM25 + å‘é‡ + RRF èåˆ
- [ ] APIï¼šentries/search æ¥å£
- [ ] MCP Toolï¼šentries_search
- [ ] å‰ç«¯ï¼š
  - æœç´¢æ å‡çº§ä¸ºè¯­ä¹‰æœç´¢
  - æœç´¢ä¸‹æ‹‰é¢„è§ˆ
  - æœç´¢ç»“æœé¡µï¼šå‘½ä¸­ç‰‡æ®µé«˜äº® + ç›¸å…³åº¦åˆ†æ•° + ç­›é€‰é¢æ¿
- [ ] é•¿æ–‡æ¡£æ”¯æŒï¼š
  - entry_get çš„ outline æ¨¡å¼
  - entry_get_section / entry_update_section
  - MCP Tools å¯¹åº”æ›´æ–°

### Phase 3ï¼šæ–‡æ¡£å…³è”

**ç›®æ ‡**ï¼šå®ç°æ–‡æ¡£ä¹‹é—´çš„æ˜¾å¼å…³è”å’Œæ™ºèƒ½æ¨èã€‚

- [ ] entry_relations è¡¨å’Œ API
- [ ] MCP Toolsï¼šentry_relations_list, entry_relation_create, entry_relation_delete, entry_find_related
- [ ] å‰ç«¯ï¼š
  - æ–‡æ¡£è¯¦æƒ…é¡µåº•éƒ¨"å…³è”æ–‡æ¡£"åŒºåŸŸ
  - [+ æ·»åŠ å…³è”] äº¤äº’ï¼ˆæœç´¢æ–‡æ¡£ + é€‰æ‹©å…³è”ç±»å‹ï¼‰
  - AI å»ºè®®å…³è”ï¼ˆåŸºäºå‘é‡ç›¸ä¼¼åº¦ï¼‰
  - å…³è”æ–‡æ¡£ç‚¹å‡»è·³è½¬
- [ ] MCP Resourceï¼šentry/{id}/context

### Phase 4ï¼šä½“éªŒä¼˜åŒ–

**ç›®æ ‡**ï¼šæ‰“ç£¨ç»†èŠ‚ï¼Œæå‡æ•´ä½“ä½¿ç”¨ä½“éªŒã€‚

- [ ] ç‰ˆæœ¬å†å² UIï¼šç‰ˆæœ¬åˆ—è¡¨ + diff å¯¹æ¯”è§†å›¾
- [ ] æ‰¹é‡æ“ä½œï¼šæ‰¹é‡æ‰“æ ‡ç­¾ã€ç§»åŠ¨ç¬”è®°æœ¬ã€åˆ é™¤
- [ ] æœç´¢å¿«æ·è¯­æ³•ï¼š`#æ ‡ç­¾å` `@ç¬”è®°æœ¬å`
- [ ] å…³è”å¯è§†åŒ–ï¼šä»¥å½“å‰æ–‡æ¡£ä¸ºä¸­å¿ƒçš„ä¸€è·³å…³ç³»å›¾ï¼ˆreact-flow / D3ï¼‰
- [ ] Agent æ“ä½œæ—¥å¿— 30 å¤©è‡ªåŠ¨æ¸…ç†ï¼ˆpg_cron æˆ–åº”ç”¨å±‚å®šæ—¶ä»»åŠ¡ï¼‰
- [ ] å¯¼å‡ºåŠŸèƒ½ï¼šå•ç¯‡å¯¼å‡º Markdownã€æ‰¹é‡å¯¼å‡º
- [ ] å“åº”å¼è®¾è®¡ï¼šç§»åŠ¨ç«¯é€‚é…
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼šæœç´¢ç»“æœç¼“å­˜ã€åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨

---

## åã€ç¯å¢ƒå˜é‡

```env
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/notebrain

# NextAuth
NEXTAUTH_SECRET=your-secret
NEXTAUTH_URL=http://localhost:3000

# OpenAI (ç”¨äº embedding)
OPENAI_API_KEY=sk-...
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# MCP Server
MCP_API_BASE_URL=http://localhost:3000/api
MCP_API_KEY=your-mcp-api-key

# åº”ç”¨é…ç½®
LONG_DOC_THRESHOLD=2000
SEARCH_DEFAULT_LIMIT=5
EMBEDDING_DIMENSIONS=1536
```

---

## åä¸€ã€å…³é”®è®¾è®¡å†³ç­–è®°å½•

| å†³ç­– | é€‰æ‹© | åŸå›  |
|------|------|------|
| å…¨æ ˆæ¡†æ¶ | Next.js (ä¸ç”¨ NestJS) | ç®€åŒ–æ¶æ„ï¼Œä¸€ä¸ªé¡¹ç›®æå®šå‰åç«¯ |
| æ–‡æ¡£æ ¼å¼ | Markdown | Agent è¯»å†™å‹å¥½ï¼Œå‰ç«¯æ¸²æŸ“ç”Ÿæ€å¥½ |
| æ•°æ®åº“ | PG + pgvector (ä¸ç”¨ ES) | ä¸€åº“æå®šä¸šåŠ¡+å‘é‡+å…¨æ–‡ï¼Œè¿ç»´ç®€å• |
| çŸ¥è¯†å›¾è°± | è½»é‡å…³ç³»è¡¨ (ä¸ç”¨ Neo4j) | ç¬”è®°æœ¬+æ ‡ç­¾+å…³è”ä¸‰å±‚å¤Ÿç”¨ï¼Œä¸åšå®ä½“æŠ½å– |
| é•¿æ–‡æ¡£å¤„ç† | æŒ‰ heading åˆ‡åˆ† section | Agent å¯ä»¥æŒ‰æ®µæ“ä½œï¼ŒèŠ‚çœ token |
| ä¹è§‚é” | version å­—æ®µ | é˜²æ­¢ Agent å’Œç”¨æˆ·åŒæ—¶ä¿®æ”¹å†²çª |
| embedding æ›´æ–° | å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— | ä¸é˜»å¡å†™å…¥ï¼Œæ‰¹é‡å¯æ§ |
| æ“ä½œæ—¥å¿— | ä¿ç•™ 30 å¤© | å¹³è¡¡å­˜å‚¨å’Œå¯è¿½æº¯æ€§ |
| MCP Server | ç‹¬ç«‹è¿›ç¨‹ï¼Œè°ƒ Next.js API | èŒè´£åˆ†ç¦»ï¼ŒMCP åªåšåè®®é€‚é… |
